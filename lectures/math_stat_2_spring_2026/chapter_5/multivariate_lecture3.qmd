---
title: "Mathematical Statistics"
subtitle: "Expected Values, Covariance, and Correlation"
author:
  - name: "Samir Orujov, PhD"
    affiliations:
      - name: "ADA University, School of Business"
      - name: "Information Communication Technologies Agency, Statistics Unit"
date: today
format:
  revealjs:
    theme: default
    logo: ADA.png
    transition: slide
    slide-number: c/t
    chalkboard: true
    controls: true
    navigation-mode: linear
    width: 1280
    height: 720
    footer: "Mathematical Statistics - Covariance and Correlation"
    incremental: false
    highlight-style: tango
    code-fold: true
    menu: true
    progress: true
    history: true
    quiz:
      checkKey: 'c'
      resetKey: 'r'
      shuffleKey: 's'
      allowNumberKeys: true
      disableOnCheck: false
      disableReset: false
      shuffleOptions: true
      defaultCorrect: "‚úÖ Correct! Well done."
      defaultIncorrect: "‚ùå Not quite. Try again or check the explanation."
      includeScore: true
revealjs-plugins:
  - quiz
---

## üéØ Learning Objectives {.smaller}

::: {.learning-objectives}
By the end of this lecture, you will be able to:

- Compute **expected values of functions** of bivariate random variables using Definition 5.9

- Apply **linearity properties** (Theorems 5.6-5.8) to simplify expected value calculations

- Calculate **covariance** using both the definition and computational formula (Theorem 5.10)

- Compute and interpret the **correlation coefficient** as a standardized measure of linear association

- Apply the **portfolio variance formula** to analyze risk in multi-asset portfolios using real financial data
:::

## üìã Overview {.smaller}

::: {style="font-size:50px"}
::: {.callout-note}
## üìö Topics Covered Today

::: {.incremental}
- **Expected Value of Functions** ‚Äì Definition 5.9 and computing $E[g(Y_1, Y_2)]$

- **Theorems on Expected Values** ‚Äì Linearity and the fundamental result $E[Y_1 + Y_2] = E[Y_1] + E[Y_2]$

- **Covariance** ‚Äì Definition, interpretation, and computational formula

- **Correlation Coefficient** ‚Äì Standardized covariance, properties, and interpretation

- **Case Study** ‚Äì Portfolio optimization with real multi-asset data
:::
:::
:::

## üìñ Motivation: Why Covariance and Correlation? {.smaller}

::: {.callout-note}
## üéØ Measuring Relationships Between Variables

Understanding how two variables **move together** is fundamental in many applications:

::: {.columns}
::: {.column width="50%"}
::: {.fragment}
**Finance Applications:**

- Do stock and bond returns move together or oppositely?
- How much does adding an asset reduce portfolio risk?
- What's the systematic risk of an asset (beta)?
:::
:::

::: {.column width="50%"}
::: {.fragment}
**Other Applications:**

- Does studying more hours improve exam scores?
- Are height and weight related?
- How does advertising spending relate to sales?
:::
:::
:::
:::

**Key Question:** How do we **quantify** the strength and direction of the linear relationship between two random variables?

## üìñ Definition: Expected Value of a Function {.smaller}

::: {.callout-note}
## üìù Definition 5.9: Expected Value of $g(Y_1, Y_2)$

Let $g(Y_1, Y_2)$ be a function of random variables $Y_1$ and $Y_2$.

**Discrete Case:**
$$E[g(Y_1, Y_2)] = \sum_{y_1} \sum_{y_2} g(y_1, y_2) \cdot p(y_1, y_2)$$

**Continuous Case:**
$$E[g(Y_1, Y_2)] = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} g(y_1, y_2) \cdot f(y_1, y_2) \, dy_1 \, dy_2$$
:::

**Key Insight:** We can find the expected value of **any function** of $(Y_1, Y_2)$ by weighting function values by probabilities (discrete) or densities (continuous).

## üìå Example 1: Computing $E[Y_1 \cdot Y_2]$ {.smaller}

**Problem:** Let $f(y_1, y_2) = 2y_1$ for $0 < y_1 < 1$ and $0 < y_2 < 1$. Find $E[Y_1 \cdot Y_2]$.

**Solution:**

. . .

Using Definition 5.9 with $g(y_1, y_2) = y_1 \cdot y_2$:

$$E[Y_1 Y_2] = \int_0^1 \int_0^1 y_1 y_2 \cdot 2y_1 \, dy_1 \, dy_2$$

. . .

$$= \int_0^1 \int_0^1 2y_1^2 y_2 \, dy_1 \, dy_2 = \int_0^1 2y_2 \left[ \frac{y_1^3}{3} \right]_0^1 dy_2$$

. . .

$$= \int_0^1 \frac{2y_2}{3} \, dy_2 = \frac{2}{3} \left[ \frac{y_2^2}{2} \right]_0^1 = \frac{2}{3} \cdot \frac{1}{2} = \boxed{\frac{1}{3}}$$

**Financial Context:** If $Y_1$ represents one asset's return and $Y_2$ another's, $E[Y_1 Y_2]$ is crucial for portfolio variance calculations.

## üìå Example 2: Computing $E[Y_1]$ from Joint Density {.smaller}

**Problem:** Using the same joint density $f(y_1, y_2) = 2y_1$ on $[0,1] \times [0,1]$, find $E[Y_1]$.

**Solution:**

. . .

**Method 1: Using marginal density**

From Lecture 1: $f_1(y_1) = \int_0^1 2y_1 \, dy_2 = 2y_1$

$$E[Y_1] = \int_0^1 y_1 \cdot 2y_1 \, dy_1 = 2 \int_0^1 y_1^2 \, dy_1 = 2 \cdot \frac{1}{3} = \boxed{\frac{2}{3}}$$

. . .

**Method 2: Using joint density directly**

$$E[Y_1] = \int_0^1 \int_0^1 y_1 \cdot 2y_1 \, dy_2 \, dy_1 = \int_0^1 2y_1^2 \left[ y_2 \right]_0^1 dy_1 = \int_0^1 2y_1^2 \, dy_1 = \frac{2}{3}$$

Both methods give the same answer!

## üßÆ Theorems on Expected Values {.smaller}

::: {.callout-important}
## Theorems 5.6-5.8: Linearity of Expected Value

**Theorem 5.6:** $E[c] = c$ for any constant $c$

**Theorem 5.7:** $E[c \cdot g(Y_1, Y_2)] = c \cdot E[g(Y_1, Y_2)]$

**Theorem 5.8:** $E[g_1(Y_1, Y_2) + g_2(Y_1, Y_2)] = E[g_1(Y_1, Y_2)] + E[g_2(Y_1, Y_2)]$
:::

::: {.callout-tip}
## üåü Corollary: Fundamental Result

$$\boxed{E[Y_1 + Y_2] = E[Y_1] + E[Y_2]}$$

This holds **always**, regardless of whether $Y_1$ and $Y_2$ are independent!

More generally: $E[aY_1 + bY_2 + c] = aE[Y_1] + bE[Y_2] + c$
:::

## üìå Example 3: Expected Portfolio Return {.smaller}

**Problem:** An investor holds a portfolio with weight $w_1 = 0.6$ in Stock A (expected return 8%) and $w_2 = 0.4$ in Stock B (expected return 12%). Find the expected portfolio return.

**Solution:**

. . .

Let $Y_1$ = return on Stock A, $Y_2$ = return on Stock B.

Portfolio return: $R_p = w_1 Y_1 + w_2 Y_2 = 0.6 Y_1 + 0.4 Y_2$

. . .

By linearity of expected value:

$$E[R_p] = E[0.6 Y_1 + 0.4 Y_2] = 0.6 E[Y_1] + 0.4 E[Y_2]$$

. . .

$$= 0.6(0.08) + 0.4(0.12) = 0.048 + 0.048 = \boxed{0.096 = 9.6\%}$$

**Key Point:** Expected portfolio return is simply the weighted average of individual expected returns‚Äî**no covariance needed!**

## üßÆ Theorem 5.9: Independence and Expected Values {.smaller}

::: {.callout-important}
## Theorem 5.9: Product of Independent Variables

If $Y_1$ and $Y_2$ are **independent**, then for any functions $g$ and $h$:

$$E[g(Y_1) \cdot h(Y_2)] = E[g(Y_1)] \cdot E[h(Y_2)]$$

**Special Case:**
$$E[Y_1 \cdot Y_2] = E[Y_1] \cdot E[Y_2] \quad \text{(if independent)}$$
:::

**Warning:** The converse is NOT true! $E[Y_1 Y_2] = E[Y_1] E[Y_2]$ does not imply independence.

**Verification (Example 1):** We found $E[Y_1 Y_2] = 1/3$ and $E[Y_1] = 2/3$. 

For independent case: We'd also need $E[Y_2] = 1/2$ (uniform on $[0,1]$).

Check: $E[Y_1] \cdot E[Y_2] = (2/3)(1/2) = 1/3 = E[Y_1 Y_2]$ ‚úì (They ARE independent by Theorem 5.5!)

## üìñ Definition: Covariance {.smaller}

::: {.callout-note}
## üìù Definition 5.10: Covariance

The **covariance** of two random variables $Y_1$ and $Y_2$ is:

$$\text{Cov}(Y_1, Y_2) = E[(Y_1 - \mu_1)(Y_2 - \mu_2)]$$

where $\mu_1 = E[Y_1]$ and $\mu_2 = E[Y_2]$.

**Interpretation:**

- **Positive covariance:** Variables tend to deviate from their means in the **same direction**
- **Negative covariance:** Variables tend to deviate in **opposite directions**
- **Zero covariance:** No linear relationship (but variables may still be dependent!)
:::

**Notation:** $\text{Cov}(Y_1, Y_2) = \sigma_{12}$ or $\sigma_{Y_1 Y_2}$

## üßÆ Theorem 5.10: Computational Formula for Covariance {.smaller}

::: {.callout-important}
## Theorem 5.10: Shortcut Formula

$$\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - \mu_1 \mu_2 = E[Y_1 Y_2] - E[Y_1] \cdot E[Y_2]$$

**Proof:**
$$\text{Cov}(Y_1, Y_2) = E[(Y_1 - \mu_1)(Y_2 - \mu_2)]$$
$$= E[Y_1 Y_2 - \mu_2 Y_1 - \mu_1 Y_2 + \mu_1 \mu_2]$$
$$= E[Y_1 Y_2] - \mu_2 E[Y_1] - \mu_1 E[Y_2] + \mu_1 \mu_2$$
$$= E[Y_1 Y_2] - \mu_1 \mu_2 - \mu_1 \mu_2 + \mu_1 \mu_2 = E[Y_1 Y_2] - \mu_1 \mu_2$$
:::

**Practical Advantage:** The computational formula is often easier to use than the definition!

## üìå Example 4: Computing Covariance (Gasoline Problem) {.smaller}

**Problem:** For the gasoline inventory with $f(y_1, y_2) = 3y_1$ on $0 \leq y_2 \leq y_1 \leq 1$, find $\text{Cov}(Y_1, Y_2)$.

**Solution:**

. . .

**Step 1: Find $E[Y_1]$ and $E[Y_2]$**

$$E[Y_1] = \int_0^1 y_1 \cdot 3y_1^2 \, dy_1 = 3 \int_0^1 y_1^3 \, dy_1 = 3 \cdot \frac{1}{4} = \frac{3}{4}$$

$$E[Y_2] = \int_0^1 y_2 \cdot \frac{3}{2}(1 - y_2^2) \, dy_2 = \frac{3}{2} \int_0^1 (y_2 - y_2^3) \, dy_2 = \frac{3}{2} \left( \frac{1}{2} - \frac{1}{4} \right) = \frac{3}{8}$$

. . .

**Step 2: Find $E[Y_1 Y_2]$**

$$E[Y_1 Y_2] = \int_0^1 \int_0^{y_1} y_1 y_2 \cdot 3y_1 \, dy_2 \, dy_1 = \int_0^1 3y_1^2 \left[ \frac{y_2^2}{2} \right]_0^{y_1} dy_1 = \int_0^1 \frac{3y_1^4}{2} \, dy_1 = \frac{3}{10}$$

. . .

**Step 3: Compute covariance**

$$\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - E[Y_1] E[Y_2] = \frac{3}{10} - \frac{3}{4} \cdot \frac{3}{8} = \frac{3}{10} - \frac{9}{32} = \frac{48 - 45}{160} = \boxed{\frac{3}{160}}$$

## üßÆ Theorem 5.11: Independence and Covariance {.smaller}

::: {.callout-important}
## Theorem 5.11: Independent Variables Have Zero Covariance

If $Y_1$ and $Y_2$ are **independent**, then:

$$\text{Cov}(Y_1, Y_2) = 0$$

**Proof:** If independent, $E[Y_1 Y_2] = E[Y_1] E[Y_2]$ (Theorem 5.9).

Therefore: $\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - E[Y_1] E[Y_2] = 0$
:::

::: {.callout-warning}
## ‚ö†Ô∏è Critical Warning: The Converse is FALSE!

$\text{Cov}(Y_1, Y_2) = 0$ does **NOT** imply $Y_1$ and $Y_2$ are independent!

**Example 5.24 in textbook:** $Y_2 = Y_1^2$ where $Y_1 \sim \text{Uniform}(-1, 1)$.

Then $\text{Cov}(Y_1, Y_2) = 0$ but $Y_1$ and $Y_2$ are clearly **not** independent (one is a function of the other!).

Zero covariance only means no **linear** relationship.
:::

## üìñ Definition: Correlation Coefficient {.smaller}

::: {.callout-note}
## üìù Definition 5.11: Correlation Coefficient

The **correlation coefficient** (or simply correlation) of $Y_1$ and $Y_2$ is:

$$\rho = \rho_{Y_1 Y_2} = \frac{\text{Cov}(Y_1, Y_2)}{\sigma_1 \sigma_2} = \frac{\sigma_{12}}{\sigma_1 \sigma_2}$$

where $\sigma_1 = \sqrt{V(Y_1)}$ and $\sigma_2 = \sqrt{V(Y_2)}$ are the standard deviations.

**Properties:**

- $-1 \leq \rho \leq 1$ (always!)
- $\rho = 1$: Perfect positive linear relationship
- $\rho = -1$: Perfect negative linear relationship
- $\rho = 0$: No linear relationship (uncorrelated)
:::

**Advantage of Correlation:** It's **dimensionless** and standardized, making comparisons across different variable pairs meaningful.

## üìå Example 5: Computing Correlation {.smaller}

**Problem:** For the gasoline problem, compute the correlation coefficient.

**Solution:**

. . .

From Example 4: $\text{Cov}(Y_1, Y_2) = \frac{3}{160}$, $E[Y_1] = \frac{3}{4}$, $E[Y_2] = \frac{3}{8}$

**Find variances:**

$$E[Y_1^2] = \int_0^1 y_1^2 \cdot 3y_1^2 \, dy_1 = 3 \int_0^1 y_1^4 \, dy_1 = \frac{3}{5}$$

$$V(Y_1) = E[Y_1^2] - (E[Y_1])^2 = \frac{3}{5} - \frac{9}{16} = \frac{48 - 45}{80} = \frac{3}{80}$$

. . .

$$E[Y_2^2] = \frac{3}{2} \int_0^1 y_2^2(1 - y_2^2) \, dy_2 = \frac{3}{2}\left(\frac{1}{3} - \frac{1}{5}\right) = \frac{1}{5}$$

$$V(Y_2) = \frac{1}{5} - \frac{9}{64} = \frac{64 - 45}{320} = \frac{19}{320}$$

. . .

$$\rho = \frac{3/160}{\sqrt{3/80} \cdot \sqrt{19/320}} = \frac{3/160}{\sqrt{57/25600}} \approx \boxed{0.397}$$

**Interpretation:** Moderate positive correlation‚Äîamount stocked and amount sold tend to move together.

## üßÆ Portfolio Variance Formula {.smaller}

::: {.callout-important}
## Variance of Linear Combinations

For any constants $a$ and $b$:

$$V(aY_1 + bY_2) = a^2 V(Y_1) + b^2 V(Y_2) + 2ab \cdot \text{Cov}(Y_1, Y_2)$$

Using correlation: 
$$V(aY_1 + bY_2) = a^2 \sigma_1^2 + b^2 \sigma_2^2 + 2ab\rho\sigma_1\sigma_2$$

**Special Cases:**

- If **independent** ($\rho = 0$): $V(Y_1 + Y_2) = V(Y_1) + V(Y_2)$
- If $\rho = 1$: $V(Y_1 + Y_2) = (\sigma_1 + \sigma_2)^2$ (no diversification benefit)
- If $\rho = -1$: $V(Y_1 + Y_2) = (\sigma_1 - \sigma_2)^2$ (maximum diversification)
:::

This is the **foundation of Modern Portfolio Theory!**

## üéÆ Interactive: Covariance Visualizer {.smaller}

::: {style="font-size: 0.8em;"}

**Explore Covariance:** See how correlation affects the scatter pattern.

::: {.columns}

::: {.column width="30%"}

```{ojs}
//| echo: false

viewof rho_slider = Inputs.range([-0.95, 0.95], {
  value: 0.5, 
  step: 0.05, 
  label: "Correlation (œÅ):"
})

viewof n_points = Inputs.range([50, 500], {
  value: 200, 
  step: 50, 
  label: "Sample size:"
})

// Generate correlated data using Cholesky decomposition
function generateCorrelatedData(n, rho) {
  let data = [];
  for (let i = 0; i < n; i++) {
    // Box-Muller for standard normals
    let u1 = Math.random(), u2 = Math.random();
    let z1 = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
    let z2 = Math.sqrt(-2 * Math.log(u1)) * Math.sin(2 * Math.PI * u2);
    // Create correlation
    let y1 = z1;
    let y2 = rho * z1 + Math.sqrt(1 - rho * rho) * z2;
    data.push({y1: y1, y2: y2});
  }
  return data;
}

corr_data = generateCorrelatedData(n_points, rho_slider)

// Compute sample statistics
sample_cov = {
  let n = corr_data.length;
  let mean1 = d3.mean(corr_data, d => d.y1);
  let mean2 = d3.mean(corr_data, d => d.y2);
  let cov = d3.sum(corr_data, d => (d.y1 - mean1) * (d.y2 - mean2)) / (n - 1);
  return cov;
}

sample_corr = {
  let n = corr_data.length;
  let mean1 = d3.mean(corr_data, d => d.y1);
  let mean2 = d3.mean(corr_data, d => d.y2);
  let var1 = d3.sum(corr_data, d => Math.pow(d.y1 - mean1, 2)) / (n - 1);
  let var2 = d3.sum(corr_data, d => Math.pow(d.y2 - mean2, 2)) / (n - 1);
  let cov = d3.sum(corr_data, d => (d.y1 - mean1) * (d.y2 - mean2)) / (n - 1);
  return cov / Math.sqrt(var1 * var2);
}

md`**True œÅ:** ${rho_slider.toFixed(2)}

**Sample Covariance:** ${sample_cov.toFixed(3)}

**Sample Correlation:** ${sample_corr.toFixed(3)}

**Interpretation:**  
${rho_slider > 0.3 ? "Positive: Y‚ÇÅ‚Üë tends with Y‚ÇÇ‚Üë" : 
  rho_slider < -0.3 ? "Negative: Y‚ÇÅ‚Üë tends with Y‚ÇÇ‚Üì" : 
  "Weak: Little linear relationship"}`
```

:::

::: {.column width="70%"}

```{ojs}
//| echo: false

Plot.plot({
  width: 750,
  height: 500,
  marginLeft: 60,
  marginBottom: 50,
  x: {
    label: "Y‚ÇÅ",
    domain: [-4, 4]
  },
  y: {
    label: "Y‚ÇÇ",
    domain: [-4, 4]
  },
  marks: [
    Plot.dot(corr_data, {
      x: "y1", 
      y: "y2", 
      fill: "steelblue",
      opacity: 0.6,
      r: 3
    }),
    Plot.linearRegressionY(corr_data, {
      x: "y1",
      y: "y2",
      stroke: "red",
      strokeWidth: 2
    }),
    Plot.ruleX([0], {stroke: "gray", strokeDasharray: "3,3"}),
    Plot.ruleY([0], {stroke: "gray", strokeDasharray: "3,3"})
  ],
  caption: html`<b>Bivariate Normal Data:</b> œÅ = ${rho_slider.toFixed(2)}. <span style="color:red">‚îÅ</span> Regression line`
})
```

:::

:::

:::

## üéÆ Interactive: Portfolio Variance Calculator {.smaller}

::: {style="font-size: 0.8em;"}

**Portfolio Risk Analysis:** See how correlation affects diversification benefits.

::: {.columns}

::: {.column width="35%"}

```{ojs}
//| echo: false

viewof w1_port = Inputs.range([0, 1], {
  value: 0.5, 
  step: 0.05, 
  label: "Weight in Asset 1 (w‚ÇÅ):"
})

viewof rho_port = Inputs.range([-1, 1], {
  value: 0.3, 
  step: 0.1, 
  label: "Correlation (œÅ):"
})

// Fixed parameters
sigma1_port = 0.20  // 20% volatility
sigma2_port = 0.30  // 30% volatility
mu1_port = 0.08     // 8% expected return
mu2_port = 0.12     // 12% expected return

w2_port = 1 - w1_port

// Portfolio calculations
port_return = w1_port * mu1_port + w2_port * mu2_port
port_variance = w1_port * w1_port * sigma1_port * sigma1_port + 
                w2_port * w2_port * sigma2_port * sigma2_port + 
                2 * w1_port * w2_port * rho_port * sigma1_port * sigma2_port
port_std = Math.sqrt(port_variance)

md`**Asset Parameters:**  
Asset 1: Œº‚ÇÅ = ${(mu1_port*100).toFixed(0)}%, œÉ‚ÇÅ = ${(sigma1_port*100).toFixed(0)}%  
Asset 2: Œº‚ÇÇ = ${(mu2_port*100).toFixed(0)}%, œÉ‚ÇÇ = ${(sigma2_port*100).toFixed(0)}%

**Portfolio Weights:**  
w‚ÇÅ = ${(w1_port*100).toFixed(0)}%, w‚ÇÇ = ${(w2_port*100).toFixed(0)}%

**Portfolio Results:**  
E[R‚Çö] = ${(port_return*100).toFixed(2)}%  
œÉ‚Çö = ${(port_std*100).toFixed(2)}%  

**Diversification Benefit:**  
Weighted avg œÉ: ${((w1_port*sigma1_port + w2_port*sigma2_port)*100).toFixed(2)}%  
Actual œÉ‚Çö: ${(port_std*100).toFixed(2)}%  
Reduction: ${(((w1_port*sigma1_port + w2_port*sigma2_port) - port_std)*100).toFixed(2)}%`
```

:::

::: {.column width="65%"}

```{ojs}
//| echo: false

// Generate efficient frontier data
frontier_data = {
  let data = [];
  for (let w = 0; w <= 1.001; w += 0.02) {
    let w2 = 1 - w;
    let ret = w * mu1_port + w2 * mu2_port;
    let variance = w * w * sigma1_port * sigma1_port + 
                   w2 * w2 * sigma2_port * sigma2_port + 
                   2 * w * w2 * rho_port * sigma1_port * sigma2_port;
    let std = Math.sqrt(variance);
    data.push({weight: w, return: ret * 100, std: std * 100});
  }
  return data;
}

// Current portfolio point
current_point = [{
  std: port_std * 100,
  return: port_return * 100
}]

// Individual assets
asset_points = [
  {std: sigma1_port * 100, return: mu1_port * 100, label: "Asset 1"},
  {std: sigma2_port * 100, return: mu2_port * 100, label: "Asset 2"}
]

Plot.plot({
  width: 600,
  height: 450,
  marginLeft: 60,
  marginBottom: 50,
  x: {
    label: "Portfolio Risk (œÉ, %)",
    domain: [0, 35]
  },
  y: {
    label: "Expected Return (%)",
    domain: [6, 14]
  },
  marks: [
    Plot.line(frontier_data, {
      x: "std", 
      y: "return", 
      stroke: "steelblue",
      strokeWidth: 3
    }),
    Plot.dot(current_point, {
      x: "std",
      y: "return",
      fill: "red",
      r: 8
    }),
    Plot.dot(asset_points, {
      x: "std",
      y: "return",
      fill: "green",
      r: 6
    }),
    Plot.text(asset_points, {
      x: "std",
      y: "return",
      text: "label",
      dy: -12,
      fill: "green"
    }),
    Plot.text(current_point, {
      x: "std",
      y: "return",
      text: ["Current Portfolio"],
      dy: -12,
      fill: "red"
    })
  ],
  caption: html`<span style="color:steelblue;font-weight:bold">‚îÅ</span> Efficient Frontier (œÅ=${rho_port.toFixed(1)}) | <span style="color:red">‚óè</span> Current | <span style="color:green">‚óè</span> Individual Assets`
})
```

:::

:::

:::

## ü§ù Think-Pair-Share: Diversification Benefits {.r-fit-text}

::: {style="font-size: 28px"}
::: {.callout-note}
## üí≠ Student Engagement Activity (5 minutes)

**Scenario:** You have two assets with:

- Asset A: Expected return = 10%, Standard deviation = 25%
- Asset B: Expected return = 6%, Standard deviation = 15%

**Think (1.5 minutes):** For a 50-50 portfolio ($w_1 = w_2 = 0.5$), calculate the portfolio variance when:

- $\rho = 1$ (perfect positive correlation)
- $\rho = 0$ (uncorrelated)
- $\rho = -1$ (perfect negative correlation)

**Pair (2 minutes):** Compare your results

- When is diversification most beneficial?
- What happens to portfolio risk as correlation decreases?

**Share (1.5 minutes):** Class discussion

- Real-world examples of assets with different correlations
- Why is finding negatively correlated assets so valuable?
:::
:::

## üí∞ Case Study: Portfolio Optimization with Real Data

::: {style="font-size:35px"}
::: {.columns}
::: {.column width="50%"}
::: {.callout-note}
## üìà Multi-Asset Portfolio Analysis

**Context**: We apply covariance and correlation concepts to build and analyze a diversified portfolio with real market data.

**Key Questions**:

- What is the correlation structure among different asset classes?

- How does diversification reduce portfolio risk?

- What portfolio weights minimize risk?

:::
:::

::: {.column width="50%"}
::: {.callout-tip}
## üìä Data Source

We analyze **monthly returns** for three assets:

- **SPY**: S&P 500 ETF (Stocks)
- **TLT**: 20+ Year Treasury Bond ETF (Bonds)
- **GLD**: Gold ETF (Commodities)

**Source**: Yahoo Finance API via `quantmod`

**Period**: Last 5 years of monthly returns

**Why these assets?**: Traditional diversified portfolio spanning stocks, bonds, and commodities
:::
:::
:::
:::

## üí∞ Case Study: Data Collection and Summary Statistics {.smaller}

::: {style="font-size:26px"}
::: {.columns}
::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Load required libraries
library(quantmod)
library(tidyverse)
library(knitr)
library(corrplot)

# Set date range (last 5 years)
end_date <- Sys.Date()
start_date <- end_date - (5 * 365)

# Download data
getSymbols(c("SPY", "TLT", "GLD"), from = start_date, 
           to = end_date, auto.assign = TRUE)

# Calculate monthly returns
spy_monthly <- monthlyReturn(SPY, type = "log")
tlt_monthly <- monthlyReturn(TLT, type = "log")
gld_monthly <- monthlyReturn(GLD, type = "log")

# Combine into data frame
returns_df <- data.frame(
  Date = index(spy_monthly),
  SPY = as.numeric(spy_monthly),
  TLT = as.numeric(tlt_monthly),
  GLD = as.numeric(gld_monthly)
) %>% na.omit()

cat(sprintf("Number of months: %d\n", nrow(returns_df)))
cat(sprintf("Period: %s to %s\n\n", 
            min(returns_df$Date), max(returns_df$Date)))
```

:::

::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Summary statistics
summary_stats <- data.frame(
  Asset = c("SPY", "TLT", "GLD"),
  Mean = c(mean(returns_df$SPY), 
           mean(returns_df$TLT), 
           mean(returns_df$GLD)) * 12 * 100,  # Annualized
  StdDev = c(sd(returns_df$SPY), 
             sd(returns_df$TLT), 
             sd(returns_df$GLD)) * sqrt(12) * 100  # Annualized
)

cat("=== Annualized Statistics ===\n")
print(summary_stats, row.names = FALSE)

# Covariance matrix (annualized)
returns_matrix <- as.matrix(returns_df[, c("SPY", "TLT", "GLD")])
cov_matrix <- cov(returns_matrix) * 12  # Annualize

cat("\n=== Annualized Covariance Matrix ===\n")
print(round(cov_matrix * 10000, 2))  # In basis points squared
```

:::
:::
:::

## üí∞ Case Study: Correlation Matrix and Heatmap {.smaller}

::: {style="font-size:26px"}
::: {.columns}
::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Correlation matrix
corr_matrix <- cor(returns_matrix)

cat("=== Correlation Matrix ===\n")
print(round(corr_matrix, 3))

# Interpretation
cat("\n=== Interpretation ===\n")
cat(sprintf("SPY-TLT correlation: %.3f\n", corr_matrix["SPY", "TLT"]))
cat(sprintf("SPY-GLD correlation: %.3f\n", corr_matrix["SPY", "GLD"]))
cat(sprintf("TLT-GLD correlation: %.3f\n", corr_matrix["TLT", "GLD"]))

cat("\n")
if(corr_matrix["SPY", "TLT"] < 0) {
  cat("SPY and TLT: Negative correlation ‚Üí Good for diversification!\n")
} else {
  cat("SPY and TLT: Positive correlation ‚Üí Less diversification benefit\n")
}
```

:::

::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| fig-width: 5
#| fig-height: 5

# Correlation heatmap
corrplot(corr_matrix, 
         method = "color",
         type = "upper",
         addCoef.col = "black",
         tl.col = "black",
         tl.srt = 45,
         col = colorRampPalette(c("#BB4444", "#FFFFFF", "#4477AA"))(200),
         title = "Correlation Matrix: SPY, TLT, GLD",
         mar = c(0, 0, 2, 0))
```

:::
:::
:::

## üí∞ Case Study: Portfolio Analysis {.smaller}

::: {style="font-size:26px"}
::: {.columns}
::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Define different portfolio allocations
portfolios <- list(
  "Equal Weight" = c(1/3, 1/3, 1/3),
  "60/40 (SPY/TLT)" = c(0.6, 0.4, 0.0),
  "Conservative" = c(0.3, 0.5, 0.2),
  "Aggressive" = c(0.7, 0.1, 0.2)
)

# Expected returns (annualized)
mu <- colMeans(returns_matrix) * 12

# Portfolio metrics
results <- data.frame(
  Portfolio = character(),
  ExpReturn = numeric(),
  StdDev = numeric(),
  Sharpe = numeric()
)

for(name in names(portfolios)) {
  w <- portfolios[[name]]
  port_return <- sum(w * mu)
  port_var <- t(w) %*% cov_matrix %*% w
  port_std <- sqrt(port_var)
  sharpe <- port_return / port_std  # Assuming rf = 0
  
  results <- rbind(results, data.frame(
    Portfolio = name,
    ExpReturn = port_return * 100,
    StdDev = port_std * 100,
    Sharpe = sharpe
  ))
}

print(results, row.names = FALSE)
```

:::

::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| fig-width: 6
#| fig-height: 5

# Plot portfolios on risk-return space
ggplot(results, aes(x = StdDev, y = ExpReturn)) +
  geom_point(size = 4, color = "steelblue") +
  geom_text(aes(label = Portfolio), 
            vjust = -1, hjust = 0.5, size = 3) +
  # Add individual assets
  geom_point(data = data.frame(
    StdDev = summary_stats$StdDev,
    ExpReturn = summary_stats$Mean
  ), color = "red", size = 3) +
  geom_text(data = data.frame(
    StdDev = summary_stats$StdDev,
    ExpReturn = summary_stats$Mean,
    label = c("SPY", "TLT", "GLD")
  ), aes(label = label), vjust = 1.5, color = "red", size = 3) +
  labs(title = "Portfolio Risk-Return Analysis",
       subtitle = "Comparing different allocation strategies",
       x = "Annualized Volatility (%)",
       y = "Annualized Expected Return (%)") +
  theme_minimal(base_size = 11) +
  xlim(0, max(summary_stats$StdDev) * 1.2)
```

:::
:::
:::

## üí∞ Case Study: Key Findings {.smaller}

::: {style="font-size: 32.5px;"}
::: {.callout-important}
## üìä Analysis Results

::: {.columns}

::: {.column width="33%"}
::: {.fragment}
**Correlation Insights:**

- SPY-TLT correlation varies over time but historically negative or low

- GLD provides additional diversification

- Low correlations among asset classes enable risk reduction
:::
:::

::: {.column width="33%"}
::: {.fragment}
**Portfolio Variance Formula in Action:**

The equal-weight portfolio typically has lower volatility than individual assets due to:

$$\sigma_p^2 = \sum_i w_i^2 \sigma_i^2 + 2\sum_{i<j} w_i w_j \rho_{ij} \sigma_i \sigma_j$$

With low/negative correlations, the cross-terms reduce total variance!
:::
:::

::: {.column width="33%"}
::: {.fragment}
**Investment Implications:**

1. **Diversification works**: Multi-asset portfolios reduce risk

2. **Correlation matters**: Assets with low correlation provide greatest benefit

3. **Trade-off**: Conservative portfolios have lower return but also lower risk
:::
:::

:::
:::
:::

## üìù Quiz #1: Computing Expected Value {.smaller .quiz-question}

If $E[Y_1] = 5$, $E[Y_2] = 10$, what is $E[3Y_1 + 2Y_2 - 7]$?

- [28]{.correct data-explanation="‚úÖ Correct! By linearity: E[3Y‚ÇÅ + 2Y‚ÇÇ - 7] = 3E[Y‚ÇÅ] + 2E[Y‚ÇÇ] - 7 = 3(5) + 2(10) - 7 = 15 + 20 - 7 = 28"}
- 35
- 22
- 15

## üìù Quiz #2: Covariance Computation {.smaller .quiz-question}

If $E[Y_1] = 2$, $E[Y_2] = 3$, and $E[Y_1 Y_2] = 7$, what is $\text{Cov}(Y_1, Y_2)$?

- [1]{.correct data-explanation="‚úÖ Correct! Using the computational formula: Cov(Y‚ÇÅ, Y‚ÇÇ) = E[Y‚ÇÅY‚ÇÇ] - E[Y‚ÇÅ]E[Y‚ÇÇ] = 7 - (2)(3) = 7 - 6 = 1"}
- 6
- 7
- -1

## üìù Quiz #3: Independence and Covariance {.smaller .quiz-question}

Which statement about covariance is TRUE?

- [If two variables are independent, their covariance must be zero]{.correct data-explanation="‚úÖ Correct! Independence implies E[Y‚ÇÅY‚ÇÇ] = E[Y‚ÇÅ]E[Y‚ÇÇ], so Cov = E[Y‚ÇÅY‚ÇÇ] - E[Y‚ÇÅ]E[Y‚ÇÇ] = 0. However, the converse is false‚Äîzero covariance does not imply independence."}
- If covariance is zero, the variables must be independent
- Covariance can be greater than 1
- Covariance equals correlation divided by the product of standard deviations

## üìù Quiz #4: Portfolio Variance {.smaller .quiz-question}

For a portfolio with $w_1 = w_2 = 0.5$, $\sigma_1 = \sigma_2 = 20\%$, and $\rho = 0$, what is the portfolio standard deviation?

- [14.14%]{.correct data-explanation="‚úÖ Correct! V(R‚Çö) = 0.5¬≤(0.20¬≤) + 0.5¬≤(0.20¬≤) + 2(0.5)(0.5)(0)(0.20)(0.20) = 0.01 + 0.01 + 0 = 0.02. So œÉ‚Çö = ‚àö0.02 = 0.1414 = 14.14%"}
- 20%
- 10%
- 28.28%

## üìù Summary {.smaller}

::: {style="font-size: 32.5px"}
::: {.summary-box}
**‚úÖ Key Takeaways**

- **Expected value of functions** $E[g(Y_1, Y_2)]$ is computed by weighting function values by joint probabilities/densities

- **Linearity**: $E[aY_1 + bY_2] = aE[Y_1] + bE[Y_2]$ always holds; $E[Y_1 Y_2] = E[Y_1]E[Y_2]$ only if independent

- **Covariance** $\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - E[Y_1]E[Y_2]$ measures linear association; computational formula is often easier

- **Correlation** $\rho = \text{Cov}(Y_1, Y_2)/(\sigma_1 \sigma_2)$ is standardized covariance with $-1 \leq \rho \leq 1$

- **Critical insight**: $\text{Cov} = 0$ does NOT imply independence! (Example 5.24)

- **Portfolio variance**: $V(w_1 Y_1 + w_2 Y_2) = w_1^2 V(Y_1) + w_2^2 V(Y_2) + 2w_1 w_2 \text{Cov}(Y_1, Y_2)$
:::
:::

## üìö Practice Problems

::: {.callout-tip}
## üìù Homework Problems

**Problem 1 (Expected Value):** For $f(y_1, y_2) = 8y_1y_2$ on $0 < y_1 < 1$, $0 < y_2 < 1$, find $E[Y_1 + Y_2]$ and $E[Y_1 Y_2]$.

**Problem 2 (Covariance):** For the joint pdf $f(y_1, y_2) = 2$ on $0 < y_1 < 1$, $0 < y_2 < y_1$, compute $\text{Cov}(Y_1, Y_2)$ and interpret.

**Problem 3 (Correlation):** Two stocks have $\sigma_1 = 30\%$, $\sigma_2 = 20\%$, and $\text{Cov} = 0.024$. Find the correlation and interpret.

**Problem 4 (Portfolio):** A portfolio has weights $w_1 = 0.4$, $w_2 = 0.6$ with $\mu_1 = 12\%$, $\mu_2 = 8\%$, $\sigma_1 = 25\%$, $\sigma_2 = 15\%$, and $\rho = 0.3$. Find expected return and standard deviation.

**Problem 5 (Zero Covariance ‚â† Independence):** Verify that for $Y_1 \sim \text{Uniform}(-1, 1)$ and $Y_2 = Y_1^2$, we have $\text{Cov}(Y_1, Y_2) = 0$ but the variables are not independent.
:::

## üëã Thank You! {.smaller .center}

::: {.columns}
::: {.column width="50%"}
**üì¨ Contact Information:**

Samir Orujov, PhD

Assistant Professor

School of Business

ADA University

üìß Email: [sorujov@ada.edu.az](mailto:sorujov@ada.edu.az)

üè¢ Office: D312

‚è∞ Office Hours: By appointment
:::

::: {.column width="50%"}
**üìÖ Next Class:**

**Topic:** Functions of Random Variables (Chapter 6)

**Reading:** Chapter 6, Sections 6.1-6.3

**Preparation:** Review change of variables in calculus

**‚è∞ Reminders:**

‚úÖ Complete Practice Problems 1-5

‚úÖ Master the portfolio variance formula

‚úÖ Remember: Cov = 0 does NOT mean independence!

‚úÖ Work hard!
:::
:::

## ‚ùì Questions? {.center}

::: {.callout-note}
## üí¨ Open Discussion

**Key Topics for Discussion:**

- Why is covariance so important in finance and portfolio theory?

- Can you think of examples where two variables have zero covariance but are clearly dependent?

- How would you estimate covariance from sample data? What are the challenges?

- What happens to diversification benefits during financial crises when correlations spike?
:::
