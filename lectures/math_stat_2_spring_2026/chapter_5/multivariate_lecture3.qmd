---
title: "Mathematical Statistics"
subtitle: "Expected Values, Covariance, and Correlation"
author:
  - name: "Samir Orujov, PhD"
    affiliations:
      - name: "ADA University, School of Business"
      - name: "Information Communication Technologies Agency, Statistics Unit"
date: today
format:
  revealjs:
    theme: default
    logo: ADA.png
    transition: slide
    slide-number: c/t
    chalkboard: true
    controls: true
    navigation-mode: linear
    width: 1280
    height: 720
    margin: 0.04
    footer: "Mathematical Statistics - Covariance and Correlation"
    incremental: false
    highlight-style: tango
    code-fold: true
    menu: true
    progress: true
    history: true
    quiz:
      checkKey: 'c'
      resetKey: 'r'
      shuffleKey: 's'
      allowNumberKeys: true
      disableOnCheck: false
      disableReset: false
      shuffleOptions: true
      defaultCorrect: "‚úÖ Correct! Well done."
      defaultIncorrect: "‚ùå Not quite. Try again or check the explanation."
      includeScore: true
revealjs-plugins:
  - quiz
---

## üéØ Learning Objectives

::: {style="font-size: 28px"}
::: {.learning-objectives}
By the end of this lecture, you will be able to:

- **Compute** expected values of functions of bivariate random variables using Definition 5.9

- **Apply** linearity properties (Theorems 5.6-5.8) to simplify expected value calculations

- **Calculate** covariance using both the definition and computational formula (Theorem 5.10)

- **Compute and interpret** the correlation coefficient as a standardized measure of linear association

- **Apply** the portfolio variance formula to analyze risk in multi-asset portfolios using real financial data
:::
:::

## üìã Overview

::: {style="font-size: 30px"}
::: {.callout-note}
## üìö Topics Covered Today

- **Expected Value of Functions** ‚Äì Definition 5.9 and computing $E[g(Y_1, Y_2)]$

- **Theorems on Expected Values** ‚Äì Linearity and fundamental result $E[Y_1 + Y_2] = E[Y_1] + E[Y_2]$

- **Covariance** ‚Äì Definition, interpretation, computational formula

- **Correlation Coefficient** ‚Äì Standardized covariance and properties

- **Case Study** ‚Äì Portfolio optimization with real data
:::
:::

## üìñ Motivation: Why Covariance and Correlation?

::: {style="font-size: 28px"}
::: {.callout-note}
## üéØ Measuring Relationships Between Variables

Understanding how two variables **move together** is fundamental in many applications:

::: {.columns}
::: {.column width="50%"}
::: {.fragment}
**Finance Applications:**

- Do stock and bond returns move together or oppositely?
- How much does adding an asset reduce portfolio risk?
- What's the systematic risk of an asset (beta)?
:::
:::

::: {.column width="50%"}
::: {.fragment}
**Other Applications:**

- Does studying more hours improve exam scores?
- Are height and weight related?
- How does advertising spending relate to sales?
:::
:::
:::
:::
:::

::: {style="font-size: 30px"}
**Key Question:** How do we **quantify** the strength and direction of the linear relationship between two random variables?
:::

## üìñ Definition: Expected Value of a Function {.smaller}

::: {style="font-size: 32px"}
::: {.callout-note}
## üìù Definition 5.9: Expected Value of $g(Y_1, Y_2)$

Let $g(Y_1, Y_2)$ be a function of random variables $Y_1$ and $Y_2$.

**Discrete Case:**
$$E[g(Y_1, Y_2)] = \sum_{y_1} \sum_{y_2} g(y_1, y_2) \cdot p(y_1, y_2)$$

**Continuous Case:**
$$E[g(Y_1, Y_2)] = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} g(y_1, y_2) \cdot f(y_1, y_2) \, dy_1 \, dy_2$$
:::
:::

::: {style="font-size: 34px"}
**Key Insight:** We can find the expected value of **any function** of $(Y_1, Y_2)$ by weighting function values by probabilities (discrete) or densities (continuous).
:::

## üìå Example 1: Computing $E[Y_1 \cdot Y_2]$

::: {style="font-size: 32px"}
**Problem:** Let $f(y_1, y_2) = 2y_1$ for $0 < y_1 < 1$ and $0 < y_2 < 1$. Find $E[Y_1 \cdot Y_2]$.
:::

. . .

::: {style="font-size: 32px"}
**Solution:** Using Definition 5.9 with $g(y_1, y_2) = y_1 \cdot y_2$:

$$E[Y_1 Y_2] = \int_0^1 \int_0^1 y_1 y_2 \cdot 2y_1 \, dy_1 \, dy_2$$
:::

. . .

::: {style="font-size: 32px"}
$$= \int_0^1 \int_0^1 2y_1^2 y_2 \, dy_1 \, dy_2 = \int_0^1 2y_2 \left[ \frac{y_1^3}{3} \right]_0^1 dy_2$$
:::

. . .

::: {style="font-size: 32px"}
$$= \int_0^1 \frac{2y_2}{3} \, dy_2 = \frac{2}{3} \left[ \frac{y_2^2}{2} \right]_0^1 = \frac{2}{3} \cdot \frac{1}{2} = \boxed{\frac{1}{3}}$$
:::

. . .

::: {style="font-size: 34px"}
**Financial Context:** If $Y_1$ represents one asset's return and $Y_2$ another's, $E[Y_1 Y_2]$ is crucial for portfolio variance calculations.
:::

## üìå Example 2: Computing $E[Y_1]$ from Joint Density

::: {style="font-size: 32px"}
**Problem:** Using the same joint density $f(y_1, y_2) = 2y_1$ on $[0,1] \times [0,1]$, find $E[Y_1]$.
:::

. . .

::: {style="font-size: 32px"}
**Method 1: Using marginal density**

From Lecture 1: $f_1(y_1) = \int_0^1 2y_1 \, dy_2 = 2y_1$

$$E[Y_1] = \int_0^1 y_1 \cdot 2y_1 \, dy_1 = 2 \int_0^1 y_1^2 \, dy_1 = 2 \cdot \frac{1}{3} = \boxed{\frac{2}{3}}$$
:::

. . .

::: {style="font-size: 32px"}
**Method 2: Using joint density directly**

$$E[Y_1] = \int_0^1 \int_0^1 y_1 \cdot 2y_1 \, dy_2 \, dy_1 = \int_0^1 2y_1^2 \left[ y_2 \right]_0^1 dy_1 = \frac{2}{3}$$

Both methods give the same answer!
:::

## üßÆ Theorems on Expected Values

::: {style="font-size: 32px"}
::: {.callout-important}
## Theorems 5.6-5.8: Linearity of Expected Value

**Theorem 5.6:** $E[c] = c$ for any constant $c$

**Theorem 5.7:** $E[c \cdot g(Y_1, Y_2)] = c \cdot E[g(Y_1, Y_2)]$

**Theorem 5.8:** $E[g_1(Y_1, Y_2) + g_2(Y_1, Y_2)] = E[g_1(Y_1, Y_2)] + E[g_2(Y_1, Y_2)]$
:::
:::

::: {style="font-size: 32px"}
::: {.callout-tip}
## üåü Corollary: Fundamental Result

$$\boxed{E[Y_1 + Y_2] = E[Y_1] + E[Y_2]}$$

This holds **always**, regardless of whether $Y_1$ and $Y_2$ are independent!

More generally: $E[aY_1 + bY_2 + c] = aE[Y_1] + bE[Y_2] + c$
:::
:::

## üìå Example 3: Expected Portfolio Return

::: {style="font-size: 30px"}
**Problem:** An investor holds a portfolio with weight $w_1 = 0.6$ in Stock A (expected return 8%) and $w_2 = 0.4$ in Stock B (expected return 12%). Find the expected portfolio return.
:::

. . .

::: {style="font-size: 32px"}
Let $Y_1$ = return on Stock A, $Y_2$ = return on Stock B.

Portfolio return: $R_p = w_1 Y_1 + w_2 Y_2 = 0.6 Y_1 + 0.4 Y_2$
:::

. . .

::: {style="font-size: 32px"}
By linearity of expected value:

$$E[R_p] = E[0.6 Y_1 + 0.4 Y_2] = 0.6 E[Y_1] + 0.4 E[Y_2]$$
:::

. . .

::: {style="font-size: 32px"}
$$= 0.6(0.08) + 0.4(0.12) = 0.048 + 0.048 = \boxed{0.096 = 9.6\%}$$
:::

. . .

::: {style="font-size: 34px"}
**Key Point:** Expected portfolio return is simply the weighted average of individual expected returns‚Äî**no covariance needed!**
:::

## üßÆ Theorem 5.9: Independence and Expected Values

::: {style="font-size: 32px"}
::: {.callout-important}
## Theorem 5.9: Product of Independent Variables

If $Y_1$ and $Y_2$ are **independent**, then for any functions $g$ and $h$:

$$E[g(Y_1) \cdot h(Y_2)] = E[g(Y_1)] \cdot E[h(Y_2)]$$

**Special Case:**
$$E[Y_1 \cdot Y_2] = E[Y_1] \cdot E[Y_2] \quad \text{(if independent)}$$
:::
:::

::: {style="font-size: 32px"}
**Warning:** The converse is NOT true! $E[Y_1 Y_2] = E[Y_1] E[Y_2]$ does not imply independence.

**Verification (Example 1):** We found $E[Y_1 Y_2] = 1/3$ and $E[Y_1] = 2/3$. For independent case: We'd also need $E[Y_2] = 1/2$ (uniform on $[0,1]$).

Check: $E[Y_1] \cdot E[Y_2] = (2/3)(1/2) = 1/3 = E[Y_1 Y_2]$ ‚úì
:::

## üìñ Definition: Covariance

::: {style="font-size: 32px"}
::: {.callout-note}
## üìù Definition 5.10: Covariance

The **covariance** of two random variables $Y_1$ and $Y_2$ is:

$$\text{Cov}(Y_1, Y_2) = E[(Y_1 - \mu_1)(Y_2 - \mu_2)]$$

where $\mu_1 = E[Y_1]$ and $\mu_2 = E[Y_2]$.

**Interpretation:**

- **Positive covariance:** Variables tend to deviate from their means in the **same direction**
- **Negative covariance:** Variables tend to deviate in **opposite directions**
- **Zero covariance:** No linear relationship (but variables may still be dependent!)
:::
:::

::: {style="font-size: 34px"}
**Notation:** $\text{Cov}(Y_1, Y_2) = \sigma_{12}$ or $\sigma_{Y_1 Y_2}$
:::

## üßÆ Theorem 5.10: Computational Formula for Covariance

::: {style="font-size: 32px"}
::: {.callout-important}
## Theorem 5.10: Shortcut Formula

$$\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - \mu_1 \mu_2 = E[Y_1 Y_2] - E[Y_1] \cdot E[Y_2]$$

**Proof:**
$$\text{Cov}(Y_1, Y_2) = E[(Y_1 - \mu_1)(Y_2 - \mu_2)]$$
$$= E[Y_1 Y_2 - \mu_2 Y_1 - \mu_1 Y_2 + \mu_1 \mu_2]$$
$$= E[Y_1 Y_2] - \mu_2 E[Y_1] - \mu_1 E[Y_2] + \mu_1 \mu_2$$
$$= E[Y_1 Y_2] - \mu_1 \mu_2 - \mu_1 \mu_2 + \mu_1 \mu_2 = E[Y_1 Y_2] - \mu_1 \mu_2$$
:::
:::

::: {style="font-size: 34px"}
**Key Insight:** If $Y_1$ and $Y_2$ are independent, then $E[Y_1 Y_2] = E[Y_1] E[Y_2]$, so $\text{Cov}(Y_1, Y_2) = 0$.
:::

## üìå Example 4: Computing Covariance

::: {style="font-size: 32px"}
**Problem:** For the joint density from Example 1, $f(y_1, y_2) = 2y_1$ on $[0,1] \times [0,1]$, find $\text{Cov}(Y_1, Y_2)$.
:::

. . .

::: {style="font-size: 32px"}
**Solution:** From previous examples:

- $E[Y_1] = 2/3$
- $E[Y_2] = 1/2$ (uniform on $[0,1]$)
- $E[Y_1 Y_2] = 1/3$
:::

. . .

::: {style="font-size: 32px"}
Using the computational formula:

$$\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - E[Y_1] \cdot E[Y_2]$$
$$= \frac{1}{3} - \frac{2}{3} \cdot \frac{1}{2} = \frac{1}{3} - \frac{1}{3} = \boxed{0}$$
:::

. . .

::: {style="font-size: 34px"}
**Interpretation:** Zero covariance confirms independence (from Theorem 5.5). Stock returns have no linear relationship.
:::

## üìñ Definition: Correlation Coefficient

::: {style="font-size: 32px"}
::: {.callout-note}
## üìù Definition 5.11: Correlation Coefficient

The **correlation coefficient** between $Y_1$ and $Y_2$ is:

$$\rho = \rho_{Y_1, Y_2} = \frac{\text{Cov}(Y_1, Y_2)}{\sigma_1 \sigma_2}$$

where $\sigma_1 = \sqrt{V(Y_1)}$ and $\sigma_2 = \sqrt{V(Y_2)}$ are the standard deviations.
:::
:::

::: {style="font-size: 32px"}
::: {.callout-important}
## üåü Properties of Correlation

1. **Bounded:** $-1 \leq \rho \leq 1$ always
2. **Dimensionless:** No units, unlike covariance
3. **Standardized:** Same interpretation across different scales
4. **Perfect linear relationship:** $|\rho| = 1$ if and only if $Y_2 = a + bY_1$ for constants $a, b$
:::
:::

## üìå Correlation Interpretation Guide

::: {style="font-size: 28px"}
::: {.columns}
::: {.column width="50%"}
**Correlation Values:**

- $\rho = +1$: Perfect positive linear
- $\rho > 0.7$: Strong positive
- $0.3 < \rho < 0.7$: Moderate positive
- $-0.3 < \rho < 0.3$: Weak/no correlation
- $\rho < -0.7$: Strong negative
- $\rho = -1$: Perfect negative linear
:::

::: {.column width="50%"}
**Financial Examples:**

- Stocks in same sector: $\rho \approx 0.6-0.8$
- Stocks and bonds: $\rho \approx -0.2$ to $+0.2$
- Gold and USD: $\rho \approx -0.3$ to $-0.5$
- S&P 500 vs individual stocks: $\rho \approx 0.4-0.9$
:::
:::
:::

## üßÆ Theorem 5.11: Variance of Linear Combinations

::: {style="font-size: 32px"}
::: {.callout-important}
## Theorem 5.11: Portfolio Variance Formula

For any constants $a$ and $b$:

$$V(aY_1 + bY_2) = a^2 V(Y_1) + b^2 V(Y_2) + 2ab \text{ Cov}(Y_1, Y_2)$$

**In terms of correlation:**

$$V(aY_1 + bY_2) = a^2 \sigma_1^2 + b^2 \sigma_2^2 + 2ab\rho\sigma_1\sigma_2$$
:::
:::

::: {style="font-size: 32px"}
**Special Cases:**

- If $Y_1$ and $Y_2$ are **independent**: $\rho = 0$, so $V(aY_1 + bY_2) = a^2 V(Y_1) + b^2 V(Y_2)$
- For a portfolio with weights $w_1$ and $w_2$: $$\sigma_p^2 = w_1^2\sigma_1^2 + w_2^2\sigma_2^2 + 2w_1w_2\rho\sigma_1\sigma_2$$
:::

## üìå Example 5: Portfolio Standard Deviation

::: {style="font-size: 30px"}
**Problem:** Portfolio with $w_1 = 0.6$ in Stock A ($\sigma_1 = 20\%$) and $w_2 = 0.4$ in Stock B ($\sigma_2 = 15\%$), with correlation $\rho = 0.5$. Find portfolio standard deviation.
:::

. . .

::: {style="font-size: 32px"}
**Solution:** Using the portfolio variance formula:

$$\sigma_p^2 = w_1^2\sigma_1^2 + w_2^2\sigma_2^2 + 2w_1w_2\rho\sigma_1\sigma_2$$
:::

. . .

::: {style="font-size: 32px"}
$$= (0.6)^2(0.20)^2 + (0.4)^2(0.15)^2 + 2(0.6)(0.4)(0.5)(0.20)(0.15)$$
:::

. . .

::: {style="font-size: 32px"}
$$= 0.0144 + 0.0036 + 0.0072 = 0.0252$$

$$\sigma_p = \sqrt{0.0252} = 0.1587 = \boxed{15.87\%}$$
:::

. . .

::: {style="font-size: 34px"}
**Key Insight:** Portfolio risk (15.87%) < weighted average of individual risks (18%) due to diversification!
:::

## ü§ù Think-Pair-Share Activity {.smaller}

::: {style="font-size: 32px"}
::: {.callout-tip}
## üí≠ Diversification Paradox

**Scenario:** You have two investment options:

- **Option A:** 100% in Stock X ($\mu = 10\%$, $\sigma = 25\%$)
- **Option B:** 50% Stock X + 50% Stock Y ($\mu_Y = 8\%$, $\sigma_Y = 20\%$, $\rho = -0.3$)

**Questions:**

1. Calculate expected return for both options
2. Calculate standard deviation for both options
3. Which option would you choose and why?

**Activity:** (3 minutes)

- **1 min:** Think individually and calculate
- **1 min:** Pair up and discuss your answers
- **1 min:** Share key insights with class
:::
:::

```{ojs}
//| echo: false
// Countdown Timer
viewof countdown = {
  const totalSeconds = 180;
  let remainingSeconds = totalSeconds;
  let intervalId;
  
  const container = html`<div style="position: fixed; right: 0; bottom: 10px; text-align: center; font-size: 42px; color: #2c3e50; font-weight: bold; padding: 15px; background: #ecf0f1; border-radius: 10px; max-width: 350px; z-index: 1000;"></div>`;
  
  function updateDisplay() {
    const minutes = Math.floor(remainingSeconds / 60);
    const seconds = remainingSeconds % 60;
    container.textContent = `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
    
    if (remainingSeconds === 0) {
      clearInterval(intervalId);
      container.textContent = "‚è∞ Time's Up!";
      container.style.background = "#e74c3c";
      container.style.color = "#fff";
    }
  }
  
  function startTimer() {
    if (intervalId) clearInterval(intervalId);
    remainingSeconds = totalSeconds;
    intervalId = setInterval(() => {
      remainingSeconds--;
      updateDisplay();
      if (remainingSeconds <= 0) clearInterval(intervalId);
    }, 1000);
    updateDisplay();
  }
  
  updateDisplay();
  
  const button = html`<button style="margin: 10px; padding: 10px 20px; font-size: 18px; cursor: pointer;">Start Timer</button>`;
  button.onclick = startTimer;
  
  ['pointerdown', 'touchstart', 'mousedown', 'click'].forEach(e => 
    button.addEventListener(e, ev => ev.stopPropagation())
  );
  
  return html`<div>${container}${button}</div>`;
}
```

## ü§ù Think-Pair-Share: Solutions

::: {style="font-size: 32px"}
::: {.columns}
::: {.column width="50%"}
**Expected Returns:**

Option A: $E[R_A] = 10\%$

Option B: $E[R_B] = 0.5(10\%) + 0.5(8\%) = 9\%$
:::

::: {.column width="50%"}
**Standard Deviations:**

Option A: $\sigma_A = 25\%$

Option B:
$$\sigma_B^2 = (0.5)^2(0.25)^2 + (0.5)^2(0.20)^2$$
$$+ 2(0.5)(0.5)(-0.3)(0.25)(0.20)$$
$$= 0.015625 + 0.01 - 0.0075 = 0.018125$$
$$\sigma_B = 13.46\%$$
:::
:::
:::

::: {style="font-size: 34px"}
**Key Insight:** Option B has lower return (9% vs 10%) but **much lower risk** (13.46% vs 25%)! The negative correlation provides powerful diversification. Most investors would prefer B for better risk-adjusted returns.
:::

## üìä Interactive: Portfolio Risk vs Correlation {.smaller}

```{ojs}
//| echo: false

viewof rho_slider = {
  const input = Inputs.range([-1, 1], {
    value: 0.3, 
    step: 0.1, 
    label: "Correlation (œÅ):",
    format: d => d.toFixed(2)
  });
  ['pointerdown', 'touchstart', 'mousedown', 'click', 'wheel', 
   'pointermove', 'touchmove'].forEach(e => 
    input.addEventListener(e, ev => ev.stopPropagation())
  );
  return input;
}

viewof w1_slider = {
  const input = Inputs.range([0, 1], {
    value: 0.5, 
    step: 0.05, 
    label: "Weight in Asset 1 (w‚ÇÅ):",
    format: d => (d * 100).toFixed(1) + "%"
  });
  ['pointerdown', 'touchstart', 'mousedown', 'click', 'wheel', 
   'pointermove', 'touchmove'].forEach(e => 
    input.addEventListener(e, ev => ev.stopPropagation())
  );
  return input;
}
```

```{ojs}
//| echo: false

// Portfolio calculations
sigma1 = 0.20  // 20% volatility for Asset 1
sigma2 = 0.15  // 15% volatility for Asset 2
w2 = 1 - w1_slider

portfolio_variance = Math.pow(w1_slider * sigma1, 2) + 
                     Math.pow(w2 * sigma2, 2) + 
                     2 * w1_slider * w2 * rho_slider * sigma1 * sigma2

portfolio_std = Math.sqrt(portfolio_variance)

// Generate efficient frontier data
weights = d3.range(0, 1.01, 0.01)
frontier_data = weights.map(w1 => {
  const w2 = 1 - w1;
  const var_p = Math.pow(w1 * sigma1, 2) + 
                Math.pow(w2 * sigma2, 2) + 
                2 * w1 * w2 * rho_slider * sigma1 * sigma2;
  return {
    w1: w1,
    std: Math.sqrt(var_p)
  };
})
```

```{ojs}
//| echo: false

Plot.plot({
  width: 600,
  height: 380,
  marginLeft: 55,
  marginBottom: 35,
  x: {
    label: "Weight in Asset 1",
    domain: [0, 1],
    grid: true
  },
  y: {
    label: "Portfolio Std Dev",
    tickFormat: d => `${(d * 100).toFixed(1)}%`,
    grid: true
  },
  marks: [
    Plot.line(frontier_data, {
      x: "w1", 
      y: "std", 
      stroke: "#2ecc71",
      strokeWidth: 3
    }),
    Plot.dot([{
      x: w1_slider, 
      y: portfolio_std
    }], {
      x: "x",
      y: "y",
      r: 6,
      fill: "#e74c3c",
      stroke: "#c0392b",
      strokeWidth: 2
    }),
    Plot.dot([
      {x: 0, y: sigma2, label: "Asset 2"},
      {x: 1, y: sigma1, label: "Asset 1"}
    ], {
      x: "x",
      y: "y",
      r: 5,
      fill: "#3498db"
    }),
    Plot.text([
      {x: 0, y: sigma2, label: "Asset 2", dy: -15},
      {x: 1, y: sigma1, label: "Asset 1", dy: -15}
    ], {
      x: "x",
      y: "y",
      text: "label",
      dy: "dy",
      fontSize: 12,
      fontWeight: "bold"
    })
  ]
})
```

::: {style="font-size: 24px; text-align: center; margin-top: 10px;"}
**Portfolio:** w‚ÇÅ=${(w1_slider * 100).toFixed(0)}%, w‚ÇÇ=${(w2 * 100).toFixed(0)}% | œÉ‚Çö=${(portfolio_std * 100).toFixed(2)}% | œÅ=${rho_slider.toFixed(1)}
:::

## üí∞ Case Study: Real Portfolio Data {.smaller}

::: {style="font-size: 30px"}
Using real data from 2010-2024:

- **SPY** (S&P 500 ETF): Large-cap US stocks
- **TLT** (20+ Year Treasury Bond ETF): Long-term government bonds
- **GLD** (Gold ETF): Precious metals
:::

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| code-fold: true

library(tidyquant)
library(tidyverse)
library(knitr)

# Download monthly returns
symbols <- c("SPY", "TLT", "GLD")
prices <- tq_get(symbols, 
                 from = "2010-01-01", 
                 to = "2024-12-31",
                 get = "stock.prices")

# Calculate monthly returns
returns <- prices %>%
  group_by(symbol) %>%
  tq_transmute(select = adjusted,
               mutate_fun = periodReturn,
               period = "monthly",
               col_rename = "return")

# Convert to matrix format
returns_matrix <- returns %>%
  pivot_wider(names_from = symbol, values_from = return) %>%
  select(-date) %>%
  as.matrix()

# Compute statistics
cov_matrix <- cov(returns_matrix) * 12  # Annualize
cor_matrix <- cor(returns_matrix)

# Summary statistics
summary_stats <- data.frame(
  Asset = symbols,
  Mean = colMeans(returns_matrix) * 12 * 100,  # Annualized %
  StdDev = apply(returns_matrix, 2, sd) * sqrt(12) * 100,  # Annualized %
  Sharpe = (colMeans(returns_matrix) * 12) / (apply(returns_matrix, 2, sd) * sqrt(12))
)

kable(summary_stats, digits = 2, 
      caption = "Asset Statistics (2010-2024, Annualized)")
```

## üí∞ Case Study: Correlation Matrix {.smaller}

::: {style="font-size: 32px"}
```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Display correlation matrix
kable(cor_matrix, digits = 3,
      caption = "Correlation Matrix")
```
:::

::: {style="font-size: 34px"}
::: {.callout-note}
## üìä Key Observations

- **SPY-TLT:** Low/slightly negative correlation ‚Üí good diversification
- **SPY-GLD:** Low positive correlation ‚Üí some diversification benefit
- **TLT-GLD:** Moderate positive correlation ‚Üí less diversification between these two

**Investment Implication:** Combining stocks (SPY) with bonds (TLT) provides excellent risk reduction due to low correlation.
:::
:::

## üí∞ Case Study: Portfolio Analysis {.smaller}

::: {style="font-size: 30px"}
::: {.columns}
::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true

# Define different portfolio allocations
portfolios <- list(
  "Equal Weight" = c(1/3, 1/3, 1/3),
  "60/40 (SPY/TLT)" = c(0.6, 0.4, 0.0),
  "Conservative" = c(0.3, 0.5, 0.2),
  "Aggressive" = c(0.7, 0.1, 0.2)
)

# Expected returns (annualized)
mu <- colMeans(returns_matrix) * 12

# Portfolio metrics
results <- data.frame(
  Portfolio = character(),
  ExpReturn = numeric(),
  StdDev = numeric(),
  Sharpe = numeric()
)

for(name in names(portfolios)) {
  w <- portfolios[[name]]
  port_return <- sum(w * mu)
  port_var <- t(w) %*% cov_matrix %*% w
  port_std <- sqrt(port_var)
  sharpe <- port_return / port_std
  
  results <- rbind(results, data.frame(
    Portfolio = name,
    ExpReturn = port_return * 100,
    StdDev = port_std * 100,
    Sharpe = sharpe
  ))
}

kable(results, digits = 2, row.names = FALSE)
```

:::

::: {.column width="50%"}

```{r}
#| echo: true
#| message: false
#| warning: false
#| eval: true
#| fig-width: 5.5
#| fig-height: 4.5

library(ggplot2)

# Plot portfolios on risk-return space
ggplot(results, aes(x = StdDev, y = ExpReturn)) +
  geom_point(size = 4, color = "steelblue") +
  geom_text(aes(label = Portfolio), 
            vjust = -1, hjust = 0.5, size = 3) +
  geom_point(data = data.frame(
    StdDev = summary_stats$StdDev,
    ExpReturn = summary_stats$Mean
  ), color = "red", size = 3) +
  geom_text(data = data.frame(
    StdDev = summary_stats$StdDev,
    ExpReturn = summary_stats$Mean,
    label = c("SPY", "TLT", "GLD")
  ), aes(label = label), vjust = 1.5, 
  color = "red", size = 3) +
  labs(title = "Portfolio Risk-Return Analysis",
       subtitle = "Comparing allocation strategies",
       x = "Annualized Volatility (%)",
       y = "Expected Return (%)") +
  theme_minimal(base_size = 12) +
  xlim(0, max(summary_stats$StdDev) * 1.2)
```

:::
:::
:::

## üí∞ Case Study: Key Findings

::: {style="font-size: 28px"}
::: {.callout-important}
## üìä Analysis Results

::: {.columns}

::: {.column width="33%"}
::: {.fragment}
**Correlation Insights:**

- SPY-TLT: Low/negative ‚Üí good diversification

- SPY-GLD: Low positive ‚Üí some benefit

- TLT-GLD: Moderate positive

- Low correlations reduce risk
:::
:::

::: {.column width="33%"}
::: {.fragment}
**Portfolio Variance:**

Equal-weight portfolio has lower risk:

$$\sigma_p^2 = \sum_i w_i^2 \sigma_i^2 + 2\sum_{i<j} w_i w_j \rho_{ij} \sigma_i \sigma_j$$

Low/negative œÅ reduces variance!
:::
:::

::: {.column width="33%"}
::: {.fragment}
**Investment Implications:**

1. Diversification works

2. Correlation matters most

3. Trade-off: lower risk = lower return
:::
:::

:::
:::
:::

## üìù Quiz #1: Computing Expected Value {.quiz-question}

::: {style="font-size: 34px"}
If $E[Y_1] = 5$, $E[Y_2] = 10$, what is $E[3Y_1 + 2Y_2 - 7]$?

- [28]{.correct data-explanation="‚úÖ Correct! By linearity: E[3Y‚ÇÅ + 2Y‚ÇÇ - 7] = 3E[Y‚ÇÅ] + 2E[Y‚ÇÇ] - 7 = 3(5) + 2(10) - 7 = 15 + 20 - 7 = 28"}
- 35
- 22
- 15
:::

## üìù Quiz #2: Covariance Computation {.quiz-question}

::: {style="font-size: 34px"}
If $E[Y_1] = 2$, $E[Y_2] = 3$, and $E[Y_1 Y_2] = 7$, what is $\text{Cov}(Y_1, Y_2)$?

- [1]{.correct data-explanation="‚úÖ Correct! Using the computational formula: Cov(Y‚ÇÅ, Y‚ÇÇ) = E[Y‚ÇÅY‚ÇÇ] - E[Y‚ÇÅ]E[Y‚ÇÇ] = 7 - (2)(3) = 7 - 6 = 1"}
- 6
- 7
- -1
:::

## üìù Quiz #3: Independence and Covariance {.quiz-question}

::: {style="font-size: 32px"}
Which statement about covariance is TRUE?

- [If two variables are independent, their covariance must be zero]{.correct data-explanation="‚úÖ Correct! Independence implies E[Y‚ÇÅY‚ÇÇ] = E[Y‚ÇÅ]E[Y‚ÇÇ], so Cov = E[Y‚ÇÅY‚ÇÇ] - E[Y‚ÇÅ]E[Y‚ÇÇ] = 0. However, the converse is false‚Äîzero covariance does not imply independence."}
- If covariance is zero, the variables must be independent
- Covariance can be greater than 1
- Covariance equals correlation divided by the product of standard deviations
:::

## üìù Quiz #4: Portfolio Variance {.quiz-question}

::: {style="font-size: 32px"}
For a portfolio with $w_1 = w_2 = 0.5$, $\sigma_1 = \sigma_2 = 20\%$, and $\rho = 0$, what is the portfolio standard deviation?

- [14.14%]{.correct data-explanation="‚úÖ Correct! V(R‚Çö) = 0.5¬≤(0.20¬≤) + 0.5¬≤(0.20¬≤) + 2(0.5)(0.5)(0)(0.20)(0.20) = 0.01 + 0.01 + 0 = 0.02. So œÉ‚Çö = ‚àö0.02 = 0.1414 = 14.14%"}
- 20%
- 10%
- 28.28%
:::

## üìù Summary

::: {style="font-size: 28px"}
::: {.summary-box}
**‚úÖ Key Takeaways**

- **Expected value of functions** $E[g(Y_1, Y_2)]$ is computed by weighting function values by joint probabilities/densities

- **Linearity**: $E[aY_1 + bY_2] = aE[Y_1] + bE[Y_2]$ always holds; $E[Y_1 Y_2] = E[Y_1]E[Y_2]$ only if independent

- **Covariance** $\text{Cov}(Y_1, Y_2) = E[Y_1 Y_2] - E[Y_1]E[Y_2]$ measures linear association

- **Correlation** $\rho = \text{Cov}(Y_1, Y_2)/(\sigma_1 \sigma_2)$ is standardized with $-1 \leq \rho \leq 1$

- **Critical insight**: $\text{Cov} = 0$ does NOT imply independence!

- **Portfolio variance**: $V(w_1 Y_1 + w_2 Y_2) = w_1^2 V(Y_1) + w_2^2 V(Y_2) + 2w_1 w_2 \text{Cov}(Y_1, Y_2)$
:::
:::

## üìö Practice Problems

::: {style="font-size: 28px"}
::: {.callout-tip}
## üìù Homework Problems

**Problem 1:** For $f(y_1, y_2) = 8y_1y_2$ on $0 < y_1 < 1$, $0 < y_2 < 1$, find $E[Y_1 + Y_2]$ and $E[Y_1 Y_2]$.

**Problem 2:** For $f(y_1, y_2) = 2$ on $0 < y_1 < 1$, $0 < y_2 < y_1$, compute $\text{Cov}(Y_1, Y_2)$.

**Problem 3:** Two stocks: $\sigma_1 = 30\%$, $\sigma_2 = 20\%$, $\text{Cov} = 0.024$. Find correlation.

**Problem 4:** Portfolio: $w_1 = 0.4$, $w_2 = 0.6$, $\mu_1 = 12\%$, $\mu_2 = 8\%$, $\sigma_1 = 25\%$, $\sigma_2 = 15\%$, $\rho = 0.3$. Find expected return and standard deviation.

**Problem 5:** Verify for $Y_1 \sim \text{Uniform}(-1, 1)$ and $Y_2 = Y_1^2$: $\text{Cov}(Y_1, Y_2) = 0$ but variables are dependent.
:::
:::

## üëã Thank You!

::: {style="font-size: 32px"}
::: {.columns}
::: {.column width="50%"}
**üì¨ Contact Information:**

Samir Orujov, PhD

Assistant Professor

School of Business

ADA University

üìß Email: [sorujov@ada.edu.az](mailto:sorujov@ada.edu.az)

üè¢ Office: D312

‚è∞ Office Hours: By appointment
:::

::: {.column width="50%"}
**üìÖ Next Class:**

**Topic:** Functions of Random Variables (Chapter 6)

**Reading:** Chapter 6, Sections 6.1-6.3

**Preparation:** Review change of variables in calculus

**‚è∞ Reminders:**

‚úÖ Complete Practice Problems 1-5

‚úÖ Master the portfolio variance formula

‚úÖ Remember: Cov = 0 ‚â† independence!

‚úÖ Work hard!
:::
:::
:::

## ‚ùì Questions?

::: {style="font-size: 28px"}
::: {.callout-note}
## üí¨ Open Discussion

**Key Topics for Discussion:**

- Why is covariance so important in finance and portfolio theory?

- Can you think of examples where two variables have zero covariance but are clearly dependent?

- How would you estimate covariance from sample data? What are the challenges?

- What happens to diversification benefits during financial crises when correlations spike?
:::
:::
