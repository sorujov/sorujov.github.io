---
title: "Mathematical Statistics"
subtitle: "Bivariate and Multivariate Probability Distributions"
author:
  - name: "Samir Orujov, PhD"
    affiliations:
      - name: "ADA University, School of Business"
      - name: "Information Communication Technologies Agency, Statistics Unit"
date: today
format:
  revealjs:
    theme: default
    logo: ../ADA.png
    transition: slide
    slide-number: c/t
    chalkboard: true
    controls: true
    navigation-mode: linear
    width: 1280
    height: 720
    margin: 0.04
    min-scale: 0.2
    max-scale: 2.0
    footer: "Mathematical Statistics - Bivariate and Multivariate Distributions"
    incremental: false
    highlight-style: tango
    code-fold: true
    menu: true
    progress: true
    history: true
    mouse-wheel: true
    overview: true
    zoom: true
    quiz:
      checkKey: 'c'
      resetKey: 'r'
      shuffleKey: 's'
      allowNumberKeys: true
      disableOnCheck: false
      disableReset: false
      shuffleOptions: true
      defaultCorrect: "‚úÖ Correct! Well done."
      defaultIncorrect: "‚ùå Not quite. Try again or check the explanation."
      includeScore: true
revealjs-plugins:
  - quiz
---

## üéØ Learning Objectives {.smaller}

::::: learning-objectives
:::: {style="font-size:38px"}
üìö By the end of this lecture, you will be able to:

::: incremental
-   Define and interpret **joint probability functions** for discrete bivariate random variables and verify their properties

-   Compute **joint probability density functions** for continuous bivariate random variables and calculate probabilities over specified regions

-   Derive **marginal probability distributions** from joint distributions using summation (discrete) or integration (continuous)

-   Visualize bivariate distributions using **3D surfaces**, contour plots, and understand geometric interpretations

-   Apply multivariate distribution concepts to **portfolio analysis** and financial risk assessment using real market data
:::
::::
:::::

## üìã Overview

::::: callout-note
## üìö Topics Covered Today

:::: {style="font-size:32px"}
::: incremental
-   **Introduction to Multivariate Distributions** ‚Äì Why study joint distributions? Applications in finance and economics

-   **Joint Probability Functions (Discrete)** ‚Äì Definition, properties, and examples with probability tables

-   **Joint Probability Density Functions (Continuous)** ‚Äì Definition, properties, and integration over regions

-   **Marginal Distributions** ‚Äì Extracting individual variable distributions from joint distributions

-   **Case Study** ‚Äì Portfolio returns analysis using real stock market data
:::
::::
:::::

## üìñ Why Study Multivariate Distributions?

::::::::: callout-note
## üéØ Motivation

:::::::: {style="font-size:38px"}
In the real world, random variables rarely occur in isolation. We often need to study **relationships between multiple random variables**:

::::::: columns
:::: {.column width="50%"}
::: fragment
**Finance Applications:**

-   Portfolio returns (multiple stocks)
-   Risk factors affecting asset prices
-   Interest rates and inflation
-   Credit risk and market risk
:::
::::

:::: {.column width="50%"}
::: fragment
**Other Applications:**

-   Height and weight of individuals
-   Temperature and humidity
-   Supply and demand quantities
-   Test scores across subjects
:::
::::
:::::::
::::::::
:::::::::

## üìñ Definition: Joint Probability Function (Discrete) {.larger}

:::::: {.callout-note style="font-size:45px;"}
## üìù Definition 5.1: Bivariate Probability Function

Let $Y_1$ and $Y_2$ be discrete random variables. The **joint (bivariate) probability function** for $Y_1$ and $Y_2$ is:

$$p(y_1, y_2) = P(Y_1 = y_1, Y_2 = y_2)$$

for all pairs $(y_1, y_2)$ in the joint sample space.

::::: columns
::: {.column .fragment width="50%"}
**Interpretation:** $p(y_1, y_2)$ gives the probability that $Y_1$ takes value $y_1$ **and** $Y_2$ takes value $y_2$ simultaneously.
:::

::: {.column .fragment width="50%"}
**Notation:** We write $(Y_1, Y_2)$ to denote a **bivariate random variable** (or random vector) consisting of two components.
:::
:::::
::::::

## üßÆ Theorem: Properties of Joint Probability Functions {.larger}

::::::: {.callout-important style="font-size:40px;"}
## Theorem 5.1: Properties of Joint Probability Functions

For any joint probability function $p(y_1, y_2)$:

::::: columns
::: {.column .fragment width="50%"}
**Property 1 (Non-negativity):** $$p(y_1, y_2) \geq 0 \quad \text{for all } (y_1, y_2)$$
:::

::: {.column .fragment width="50%"}
**Property 2 (Normalization):** $$\sum_{y_1} \sum_{y_2} p(y_1, y_2) = 1$$

The double sum is taken over all possible pairs $(y_1, y_2)$ in the sample space.
:::
:::::

::: {.fragment style="font-size:30px;"}
**Intuition:** Probabilities must be non-negative and sum to 1 across all possible outcomes‚Äîthe same principles as univariate distributions, extended to pairs!
:::
:::::::

## üìå Example 1: Dice Tossing Experiment {.smaller}


**Problem:** Consider tossing two fair dice. Let $Y_1$ = value on die 1 and $Y_2$ = value on die 2. Find the joint probability function.

**Solution:**

. . .

Since each die has 6 faces and the tosses are independent:

$$p(y_1, y_2) = P(Y_1 = y_1) \cdot P(Y_2 = y_2) = \frac{1}{6} \cdot \frac{1}{6} = \frac{1}{36}$$

. . .

for all $y_1, y_2 \in \{1, 2, 3, 4, 5, 6\}$.

::::: columns
::: {.column .fragment style="width:50%; font-size:30px;"} 
**Sample Space:** 36 equally likely outcomes

$(1,1), (1,2), \ldots, (6,6)$
:::

::: {.column .fragment style="width:50%; font-size:30px;"}
**Verification:** $$\sum_{y_1=1}^{6} \sum_{y_2=1}^{6} \frac{1}{36} = 36 \cdot \frac{1}{36} = 1 \checkmark$$
:::
:::::


## üìå Example 2: Committee Selection (Discrete) {.smaller}

**Problem:** A committee of 3 is selected at random from 4 Republicans and 3 Democrats. Let $Y_1$ = number of Republicans and $Y_2$ = number of Democrats selected.

**Solution:**

::::: columns
::: {.column .fragment width="50%"}
The joint probability function is:

$$p(y_1, y_2) = \frac{\binom{4}{y_1} \binom{3}{y_2}}{\binom{7}{3}}$$

where $y_1 + y_2 = 3$, $y_1 \in \{0, 1, 2, 3\}$, $y_2 \in \{0, 1, 2, 3\}$.
:::

::: {.column .fragment width="50%"}
**Joint Probability Table:**

| $y_1 \backslash y_2$ | 0 | 1 | 2 | 3 |
|:--:|:--:|:--:|:--:|:--:|
| **0** | 0 | 0 | 0 | $\frac{1}{35}$ |
| **1** | 0 | 0 | $\frac{12}{35}$ | 0 |
| **2** | 0 | $\frac{18}{35}$ | 0 | 0 |
| **3** | $\frac{4}{35}$ | 0 | 0 | 0 |

**Note:** Only cells where $y_1 + y_2 = 3$ have non-zero probabilities.
:::
:::::

## üìñ Definition: Joint Distribution Function {.larger}

::: {.callout-note style="font-size: 38px;"}
## üìù Definition 5.2: Joint Distribution Function (CDF)

The **joint distribution function** (or joint CDF) for random variables $Y_1$ and $Y_2$ is:

$$F(y_1, y_2) = P(Y_1 \leq y_1, Y_2 \leq y_2)$$

for $-\infty < y_1 < \infty$ and $-\infty < y_2 < \infty$.

**Interpretation:** $F(y_1, y_2)$ gives the probability that $Y_1$ is at most $y_1$ **and** $Y_2$ is at most $y_2$.
:::

## üìê Geometric Interpretation of Joint CDF {.larger}

::: {.callout-tip style="font-size: 34px;"}
## üìç The "Southwest Rectangle"

$F(y_1, y_2)$ represents the probability accumulated in the rectangular region from $(-\infty, -\infty)$ to $(y_1, y_2)$.

:::: columns
::: {.column width="50%"}
**For Discrete Variables:**

Sum all probabilities where $y_1' \leq y_1$ and $y_2' \leq y_2$:

$$F(y_1, y_2) = \sum_{y_1' \leq y_1} \sum_{y_2' \leq y_2} p(y_1', y_2')$$
:::

::: {.column width="50%"}
**For Continuous Variables:**

Integrate the joint pdf from $-\infty$ to $(y_1, y_2)$:

$$F(y_1, y_2) = \int_{-\infty}^{y_1} \int_{-\infty}^{y_2} f(t_1, t_2) \, dt_2 \, dt_1$$
:::
::::

üí° **Visual:** The CDF at $(a, b)$ captures all probability mass in the quadrant below and to the left.
:::


## üßÆ Theorem: Properties of Joint CDFs {.larger}

::: {.callout-important style="font-size:38px !important;"}
## Theorem 5.2: Properties of Bivariate CDFs

For any joint distribution function $F(y_1, y_2)$:

1.  $\lim_{y_1 \to -\infty} F(y_1, y_2) = \lim_{y_2 \to -\infty} F(y_1, y_2) = 0$

2.  $\lim_{y_1 \to \infty, y_2 \to \infty} F(y_1, y_2) = 1$

3.  If $y_1^* \geq y_1$ and $y_2^* \geq y_2$, then $F(y_1^*, y_2^*) \geq F(y_1, y_2)$ (non-decreasing)

4.  $F(y_1, y_2)$ is right-continuous in each argument
:::

. . .

**Intuition:** The CDF starts at 0, increases monotonically, and approaches 1 as both variables go to infinity.

## üìñ Definition: Joint Probability Density Function (Continuous) {.larger}

::: {.callout-note style="margin-top: -10px;"}
## üìù Definition 5.3: Joint Probability Density Function

Random variables $Y_1$ and $Y_2$ are said to be **jointly continuous** if their joint distribution function $F(y_1, y_2)$ can be written as:

::: {style="margin-top: -20px;"}
$$F(y_1, y_2) = \int_{-\infty}^{y_1} \int_{-\infty}^{y_2} f(t_1, t_2) \, dt_2 \, dt_1$$

for some non-negative function $f(y_1, y_2)$ called the **joint probability density function** (pdf).
:::

**Key Relationship:** $$f(y_1, y_2) = \frac{\partial^2 F(y_1, y_2)}{\partial y_1 \, \partial y_2}$$

where this derivative exists.
:::

## üßÆ Theorem: Properties of Joint PDFs {.larger}

:::::: callout-important
## Theorem 5.3: Properties of Joint Probability Density Functions

For any joint pdf $f(y_1, y_2)$:

::::: columns
::: {.column width="50%"}
**Property 1 (Non-negativity):** $$f(y_1, y_2) \geq 0 \quad \text{for all } (y_1, y_2)$$
:::

::: {.column width="50%"}
**Property 2 (Normalization):** $$\int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(y_1, y_2) \, dy_1 \, dy_2 = 1$$
:::
:::::

**Probability Calculation:** $$P[(Y_1, Y_2) \in A] = \iint_A f(y_1, y_2) \, dy_1 \, dy_2$$
::::::

::: {style="margin-top: -20px !important;"}
**Geometric Interpretation:** The **volume** under the surface $z = f(y_1, y_2)$ over region $A$ gives the probability.
:::

## üìå Example 3: Uniform Distribution on Unit Square {.smaller}

**Problem:** A radioactive particle is equally likely to land anywhere in a unit square. Let $(Y_1, Y_2)$ denote the landing coordinates. Find the joint pdf and $P(Y_1 + Y_2 \leq 1)$.

**Solution:**

::::: columns
::: {.column .fragment width="50%"}
Since the particle is equally likely to land anywhere:

$$f(y_1, y_2) = \begin{cases} 1 & \text{if } 0 \leq y_1 \leq 1, \, 0 \leq y_2 \leq 1 \\ 0 & \text{otherwise} \end{cases}$$

**Verification:** $\int_0^1 \int_0^1 1 \, dy_1 \, dy_2 = 1 \checkmark$
:::

::: {.column .fragment width="50%"}
**Finding** $P(Y_1 + Y_2 \leq 1)$:

$$P(Y_1 + Y_2 \leq 1) = \int_0^1 \int_0^{1-y_1} 1 \, dy_2 \, dy_1 $$ 
$$ = \int_0^1 (1 - y_1) \, dy_1 = \left[ y_1 - \frac{y_1^2}{2} \right]_0^1 = \frac{1}{2}$$
:::
:::::

. . .

**Geometric:** This is the area of the triangle below the line $y_1 + y_2 = 1$ within the unit square.

## üéÆ Interactive: Uniform Distribution on Unit Square {.smaller}

:::::: {style="font-size: 0.75em; margin-top: -5px;"}

::::: columns
::: {.column width="20%"}
```{ojs}
//| echo: false

viewof threshold = {
  const input = Inputs.range([0.2, 2], {
    value: 1, 
    step: 0.1, 
    label: "Threshold c:"
  });
  
  // Prevent slide navigation when interacting with slider
  input.addEventListener('pointerdown', e => e.stopPropagation());
  input.addEventListener('touchstart', e => e.stopPropagation());
  input.addEventListener('mousedown', e => e.stopPropagation());
  input.addEventListener('click', e => e.stopPropagation());
  
  return input;
}

// Calculate probability P(Y1 + Y2 <= c)
prob_uniform = {
  const c = threshold;
  if (c <= 0) return 0;
  if (c >= 2) return 1;
  if (c <= 1) {
    return c * c / 2;
  } else {
    return 1 - (2 - c) * (2 - c) / 2;
  }
}

html`<div style="font-size: 1.15em; line-height: 1.4;">
<p><strong>Density:</strong> <em>f</em>(y‚ÇÅ, y‚ÇÇ) = 1 on [0,1]¬≤</p>
<hr style="margin: 8px 0;"/>
<p><strong>Region:</strong> y‚ÇÅ + y‚ÇÇ ‚â§ ${threshold.toFixed(1)}</p>
<hr style="margin: 8px 0;"/>
<p style="font-size: 1.6em; color: #2563eb; margin: 10px 0;">
<strong>P = ${prob_uniform.toFixed(4)}</strong>
</p>
<hr style="margin: 8px 0;"/>
<p style="font-size: 1em;">
${threshold <= 1 ? 
  `c¬≤/2 = ${threshold.toFixed(1)}¬≤/2` :
  threshold < 2 ?
  `1 - (2-c)¬≤/2` :
  `= 1 (full square)`
}
</p>
<hr style="margin: 8px 0;"/>
<p style="font-size: 1em;"><strong>Try:</strong></p>
<ul style="margin: 5px 0; padding-left: 18px; font-size: 1em;">
<li>c=1 ‚Üí P=0.5</li>
<li>c=2 ‚Üí P=1</li>
<li>c<1 ‚Üí small</li>
</ul>
</div>`
```
:::

::: {.column width="40%"}
```{ojs}
//| echo: false

// 2D Top View Plot
{
  const width = 460;
  const height = 460;
  const margin = 30;
  
  const n = 20;
  const surface_data = [];
  for (let i = 0; i <= n; i++) {
    for (let j = 0; j <= n; j++) {
      const y1 = i / n;
      const y2 = j / n;
      surface_data.push({
        y1: y1,
        y2: y2,
        inRegion: (y1 + y2) <= threshold
      });
    }
  }
  
  return Plot.plot({
    width: width,
    height: height,
    margin: margin,
    style: { fontSize: "12px" },
    marks: [
      Plot.dot(surface_data, {
        x: "y1",
        y: "y2",
        fill: d => d.inRegion ? "#3b82f6" : "#e5e7eb",
        r: 6,
        opacity: d => d.inRegion ? 0.9 : 0.25
      }),
      Plot.frame({stroke: "black", strokeWidth: 2}),
      Plot.line(
        threshold <= 2 ? [
          {y1: 0, y2: Math.min(threshold, 1)},
          {y1: Math.min(threshold, 1), y2: 0}
        ] : [],
        { x: "y1", y: "y2", stroke: "red", strokeWidth: 3, strokeDasharray: "5,3" }
      ),
      Plot.text([{x: 0.5, y: -0.1, label: "y‚ÇÅ"}], { x: "x", y: "y", text: "label", fontSize: 14, fontWeight: "bold" }),
      Plot.text([{x: -0.1, y: 0.5, label: "y‚ÇÇ"}], { x: "x", y: "y", text: "label", fontSize: 14, fontWeight: "bold" })
    ],
    x: { label: null, domain: [0, 1], ticks: 5 },
    y: { label: null, domain: [0, 1], ticks: 5 }
  });
}
```
<div style="text-align: center; font-size: 1em; margin-top: 3px;">
<strong>Integration Region</strong> ‚Äî Blue: y‚ÇÅ + y‚ÇÇ ‚â§ c
</div>
:::

::: {.column width="40%"}
```{ojs}
//| echo: false

Plotly = require("https://cdn.plot.ly/plotly-2.27.0.min.js")

// 3D Surface Plot
{
  const n = 25;
  const y1_grid = [], y2_grid = [], z_grid = [], color_grid = [];
  
  for (let i = 0; i <= n; i++) y1_grid.push(i / n);
  for (let j = 0; j <= n; j++) y2_grid.push(j / n);
  
  for (let j = 0; j <= n; j++) {
    const z_row = [], color_row = [];
    for (let i = 0; i <= n; i++) {
      z_row.push(1);
      color_row.push((y1_grid[i] + y2_grid[j]) <= threshold ? 1 : 0);
    }
    z_grid.push(z_row);
    color_grid.push(color_row);
  }
  
  const data = [{
    type: 'surface', x: y1_grid, y: y2_grid, z: z_grid,
    surfacecolor: color_grid,
    colorscale: [[0, '#e5e7eb'], [1, '#3b82f6']],
    showscale: false,
    contours: { z: { show: true, usecolormap: true, project: {z: true} } }
  }];
  
  if (threshold <= 2) {
    const line_y1 = [], line_y2 = [], line_z = [];
    for (let i = 0; i <= 50; i++) {
      const t = i / 50;
      const y1 = t * Math.min(threshold, 1);
      const y2 = Math.min(threshold - y1, 1);
      if (y1 >= 0 && y1 <= 1 && y2 >= 0 && y2 <= 1) {
        line_y1.push(y1); line_y2.push(y2); line_z.push(0);
      }
    }
    data.push({ type: 'scatter3d', mode: 'lines', x: line_y1, y: line_y2, z: line_z,
      line: { color: 'red', width: 5 }, showlegend: false });
  }
  
  const layout = {
    width: 480, height: 460,
    margin: {l: 0, r: 0, b: 0, t: 0},
    scene: {
      xaxis: {title: 'y‚ÇÅ', range: [0, 1], titlefont: {size: 14}},
      yaxis: {title: 'y‚ÇÇ', range: [0, 1], titlefont: {size: 14}},
      zaxis: {title: 'f(y‚ÇÅ,y‚ÇÇ)', range: [0, 1.2], titlefont: {size: 12}},
      camera: { eye: {x: 1.5, y: 1.5, z: 1.1} },
      aspectmode: 'cube'
    }
  };
  
  const div = DOM.element('div');
  Plotly.newPlot(div, data, layout, {displayModeBar: false});
  
  div.addEventListener('pointerdown', e => e.stopPropagation());
  div.addEventListener('touchstart', e => e.stopPropagation());
  div.addEventListener('mousedown', e => e.stopPropagation());
  div.addEventListener('wheel', e => e.stopPropagation());
  div.addEventListener('pointermove', e => e.stopPropagation());
  div.addEventListener('touchmove', e => e.stopPropagation());
  div.addEventListener('mousemove', e => e.stopPropagation());
  
  return div;
}
```
<div style="text-align: center; font-size: 1em; margin-top: 3px;">
<strong>3D Surface</strong> ‚Äî Drag to rotate
</div>
:::
:::::
::::::

## üìå Example 4: Gasoline Tank Inventory {.smaller}

**Problem:** A firm stocks gasoline for sale. Let $Y_1$ = amount stocked (in 1000s of gallons) at the start of the week, and $Y_2$ = amount sold during the week. The joint pdf is:

$$f(y_1, y_2) = \begin{cases} 3y_1 & \text{if } 0 \leq y_2 \leq y_1 \leq 1 \\ 0 & \text{otherwise} \end{cases}$$

Find the probability that less than half of the inventory is sold.

**Solution:**

::::: columns
::: {.column .fragment width="50%"}
We need $P(Y_2 < Y_1/2)$.

$$P\left(Y_2 < \frac{Y_1}{2}\right) = \int_0^1 \int_0^{y_1/2} 3y_1 \, dy_2 \, dy_1$$
:::

::: {.column .fragment width="50%"}
**Calculation:**

$$= \int_0^1 3y_1 \cdot \frac{y_1}{2} \, dy_1 = \frac{3}{2} \int_0^1 y_1^2 \, dy_1$$ $$= \frac{3}{2} \cdot \frac{1}{3} = \boxed{\frac{1}{2}}$$
:::
:::::

. . .

::: {style="margin-top: -30px;"}
**Business Insight:** There's a 50% chance of selling less than half the inventory‚Äîimportant for inventory planning!
:::

## üéÆ Interactive: Bivariate Probability Surface {.smaller}

:::::: {style="font-size: 0.72em; margin-top: -8px;"}

::::: columns
::: {.column width="32%"}
```{ojs}
//| echo: false

viewof alpha = {
  const input = Inputs.range([0.5, 3], {
    value: 1, 
    step: 0.25, 
    label: "Œ± (power of y‚ÇÅ):"
  });
  
  // Prevent slide navigation when interacting with slider
  input.addEventListener('pointerdown', e => e.stopPropagation());
  input.addEventListener('touchstart', e => e.stopPropagation());
  input.addEventListener('mousedown', e => e.stopPropagation());
  input.addEventListener('click', e => e.stopPropagation());
  
  return input;
}

viewof beta = {
  const input = Inputs.range([0.5, 3], {
    value: 1, 
    step: 0.25, 
    label: "Œ≤ (power of y‚ÇÇ):"
  });
  
  // Prevent slide navigation when interacting with slider
  input.addEventListener('pointerdown', e => e.stopPropagation());
  input.addEventListener('touchstart', e => e.stopPropagation());
  input.addEventListener('mousedown', e => e.stopPropagation());
  input.addEventListener('click', e => e.stopPropagation());
  
  return input;
}

// Calculate normalizing constant for f(y1,y2) = c * y1^alpha * y2^beta on [0,1]x[0,1]
c_constant = (alpha + 1) * (beta + 1)

html`<div style="font-size: 1.1em; line-height: 1.5;">
<p><strong>Density:</strong> <em>f</em>(y<sub>1</sub>, y<sub>2</sub>) = ${c_constant.toFixed(2)} ¬∑ y<sub>1</sub><sup>${alpha.toFixed(2)}</sup> ¬∑ y<sub>2</sub><sup>${beta.toFixed(2)}</sup> on [0,1]¬≤</p>
<hr style="margin: 10px 0;"/>
<p><strong>Normalizing constant:</strong> <em>c</em> = (Œ±+1)(Œ≤+1) = ${c_constant.toFixed(2)}</p>
<hr style="margin: 10px 0;"/>
<p><strong>What to Observe:</strong></p>
<ul style="margin: 8px 0; padding-left: 20px;">
<li><strong>Œ± = Œ≤ = 1</strong>: Uniform (flat)</li>
<li><strong>Higher Œ±</strong>: Mass shifts to large y‚ÇÅ</li>
<li><strong>Higher Œ≤</strong>: Mass shifts to large y‚ÇÇ</li>
<li><strong>Dark regions</strong> = high density</li>
</ul>
<hr style="margin: 10px 0;"/>
<p><strong>Real-World:</strong> Think of y‚ÇÅ, y‚ÇÇ as asset returns. Parameters model different risk profiles.</p>
</div>`
```
:::

::: {.column width="68%"}
```{ojs}
//| echo: false

// Generate grid for 3D-like visualization using contours
grid_size = 30
y1_vals = d3.range(0.02, 1, 1/grid_size)
y2_vals = d3.range(0.02, 1, 1/grid_size)

// Generate density values
density_data = {
  let data = [];
  for (let y1 of y1_vals) {
    for (let y2 of y2_vals) {
      let density = c_constant * Math.pow(y1, alpha) * Math.pow(y2, beta);
      data.push({y1: y1, y2: y2, density: density});
    }
  }
  return data;
}

Plot.plot({
  width: 820,
  height: 520,
  marginLeft: 55,
  marginBottom: 50,
  marginTop: 10,
  color: {
    type: "linear",
    scheme: "viridis",
    legend: true,
    label: "Density"
  },
  x: {
    label: "y‚ÇÅ ‚Üí",
    domain: [0, 1],
    labelOffset: 40
  },
  y: {
    label: "‚Üë y‚ÇÇ",
    domain: [0, 1]
  },
  marks: [
    Plot.contour(density_data, {
      x: "y1",
      y: "y2",
      fill: "density",
      blur: 5,
      thresholds: 25
    }),
    Plot.frame()
  ]
})
```
:::
:::::
::::::

## üìñ Definition: Marginal Probability Distributions {.larger}

::::: {.callout-note style="font-size: 38px;"}
## üìù Definition 5.4: Marginal Distributions

Given a joint distribution of $(Y_1, Y_2)$, the **marginal distributions** describe each variable's distribution individually.

:::: columns
::: {.column width="50%"}
**Discrete Case:** 
$$p_1(y_1) = \sum_{y_2} p(y_1, y_2)$$
$$p_2(y_2) = \sum_{y_1} p(y_1, y_2)$$
:::

::: {.column width="50%"}
**Continuous Case:** 
$$f_1(y_1) = \int_{-\infty}^{\infty} f(y_1, y_2) \, dy_2$$
$$f_2(y_2) = \int_{-\infty}^{\infty} f(y_1, y_2) \, dy_1$$
:::
::::

üí° **Intuition:** To find the marginal of $Y_1$, we "accumulate" probabilities over all values of $Y_2$.
:::::

## üìå Example 5: Marginal Distributions (Discrete) {.larger}

::::: {style="font-size: 34px;"}
**Problem:** Find the marginal distributions of $Y_1$ (Republicans) and $Y_2$ (Democrats) from the committee selection.

:::: columns
::: {.column .fragment width="50%"}
**Marginal of** $Y_1$ (sum rows):

| $y_1$ | $p_1(y_1)$ |
|:-----:|:----------:|
| 0 | $\frac{1}{35}$ |
| 1 | $\frac{12}{35}$ |
| 2 | $\frac{18}{35}$ |
| 3 | $\frac{4}{35}$ |
:::

::: {.column .fragment width="50%"}
**Marginal of** $Y_2$ (sum columns):

| $y_2$ | $p_2(y_2)$ |
|:-----:|:----------:|
| 0 | $\frac{4}{35}$ |
| 1 | $\frac{18}{35}$ |
| 2 | $\frac{12}{35}$ |
| 3 | $\frac{1}{35}$ |
:::
::::

::: {.fragment style="font-size: 30px;"}
‚úÖ **Verification:** $(1+12+18+4)/35 = 1$ ‚úîÔ∏è
:::

:::::

## üìå Example 6: Marginal Distributions (Continuous) {.larger}

::::: {style="font-size: 36px;"}
**Problem:** For $f(y_1, y_2) = 3y_1$ where $0 \leq y_2 \leq y_1 \leq 1$, find the marginals.

:::: columns
::: {.column .fragment width="50%"}
**Marginal of** $Y_1$ (stocked):

$$f_1(y_1) = \int_0^{y_1} 3y_1 \, dy_2 = \boxed{3y_1^2}$$

for $0 \leq y_1 \leq 1$

‚úÖ $\int_0^1 3y_1^2 \, dy_1 = 1$
:::

::: {.column .fragment width="50%"}
**Marginal of** $Y_2$ (sold):

$$f_2(y_2) = \int_{y_2}^{1} 3y_1 \, dy_1 = \boxed{\frac{3}{2}(1 - y_2^2)}$$

for $0 \leq y_2 \leq 1$
:::
::::
:::::

. . .

::: {.callout-tip style="font-size: 34px;"}
üíº **Business Insight:** Marginal of sales helps understand demand patterns independently of inventory decisions!
:::

## ü§ù Think-Pair-Share: Investment Decision {.larger}

::::: {style="font-size: 38px;"}
:::: callout-note
## üí≠ Activity (4 minutes)

**Joint distribution for two assets' annual returns:**

| $Y_1 \backslash Y_2$ | -5%  |  0%  | 10%  | 20%  |
|:--------------------:|:----:|:----:|:----:|:----:|
|       **-10%**       | 0.05 | 0.05 | 0.02 | 0.00 |
|        **5%**        | 0.10 | 0.15 | 0.15 | 0.05 |
|       **15%**        | 0.03 | 0.10 | 0.20 | 0.10 |

::: columns
::: {.column width="33%"}
**üß† Think (1 min):**

- Find marginal of $Y_1$
- Find marginal of $Y_2$
:::

::: {.column width="33%"}
**üë´ Pair (2 min):**

- Which asset has higher E[return]?
- Which is riskier?
:::

::: {.column width="33%"}
**üó£Ô∏è Share (1 min):**

- Why does joint distribution matter beyond marginals?
:::
:::
::::
:::::

```{r}
#| echo: false
library(countdown)
countdown(minutes = 4, seconds = 0,
          bottom = 10, right = 0,
          font_size = "1.5em",
          color_running_background = "#31b09e",
          color_running_text = "white",
          color_finished_background = "#cc3311",
          color_finished_text = "white",
          color_warning_background = "#f7dc6f",
          warn_when = 60,
          play_sound = TRUE)
```

## üí∞ Case Study: Portfolio Returns Analysis {.larger}

::::: {style="font-size: 38px;"}
:::: columns
::: {.column width="50%"}
::: {.callout-note}
## üìà Financial Application

**Context**: Study joint distribution of asset returns for:

- Diversification benefits
- Portfolio risk assessment
- Co-movement patterns

**Key Questions**:

1. What does joint distribution look like?
2. How do we extract marginals?
3. What patterns emerge?
:::
:::

::: {.column width="50%"}
::: {.callout-tip}
## üìä Data Source

**Stocks**: Apple (üçé AAPL) & Microsoft (üü¶ MSFT)

**Source**: Yahoo Finance API

**Period**: Last 252 trading days

**Data**: Daily log returns

$$r_t = \ln\left(\frac{P_t}{P_{t-1}}\right)$$
:::
:::
::::
:::::

## üí∞ Case Study: Data Collection & Stats {.larger}

```{r}
#| echo: true
#| code-fold: true
#| code-summary: "üì¶ Load Libraries & Fetch Data"
#| message: false
#| warning: false
#| eval: true

# Load libraries
library(quantmod)
library(tidyverse)
library(knitr)
library(countdown)

# Get data
end_date <- Sys.Date()
start_date <- end_date - 365
getSymbols(c("AAPL", "MSFT"), from = start_date, to = end_date, auto.assign = TRUE)

# Calculate returns
aapl_returns <- dailyReturn(AAPL, type = "log")
msft_returns <- dailyReturn(MSFT, type = "log")

returns_df <- data.frame(
  Date = index(aapl_returns),
  AAPL = as.numeric(aapl_returns),
  MSFT = as.numeric(msft_returns)
) %>% na.omit()
```

::::: {style="font-size: 36px;"}
:::: columns
::: {.column width="50%"}
```{r}
#| echo: false
#| eval: true

# Summary stats as formatted output
cat("üçé APPLE (AAPL)\n")
cat(sprintf("   Mean Return: %+.3f%%\n", mean(returns_df$AAPL) * 100))
cat(sprintf("   Volatility:  %.3f%%\n", sd(returns_df$AAPL) * 100))
cat(sprintf("   Min/Max:     %.2f%% / %+.2f%%\n\n", min(returns_df$AAPL)*100, max(returns_df$AAPL)*100))

cat("üü¶ MICROSOFT (MSFT)\n")
cat(sprintf("   Mean Return: %+.3f%%\n", mean(returns_df$MSFT) * 100))
cat(sprintf("   Volatility:  %.3f%%\n", sd(returns_df$MSFT) * 100))
cat(sprintf("   Min/Max:     %.2f%% / %+.2f%%\n", min(returns_df$MSFT)*100, max(returns_df$MSFT)*100))
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| eval: true

cat("üîó RELATIONSHIP\n")
cat(sprintf("   Correlation: %.4f\n", cor(returns_df$AAPL, returns_df$MSFT)))
cat(sprintf("   Observations: %d days\n", nrow(returns_df)))
cat(sprintf("   Period: %s to %s\n", min(returns_df$Date), max(returns_df$Date)))
cat("\nüí° INTERPRETATION:\n")
cat("   High correlation = stocks move together\n")
cat("   Limited diversification benefit\n")
```
:::
::::
:::::

## üí∞ Case Study: Joint Distribution ‚Äî Scatter Plot {.larger}

```{r}
#| echo: true
#| code-fold: true
#| code-summary: "üìä Show Scatter Plot Code"
#| message: false
#| warning: false
#| eval: true
#| fig-width: 11
#| fig-height: 6.5
#| fig-align: center

library(ggExtra)

# Main scatter plot with quadrant shading
p <- ggplot(returns_df, aes(x = AAPL * 100, y = MSFT * 100)) +
  # Add quadrant shading
  annotate("rect", xmin = 0, xmax = Inf, ymin = 0, ymax = Inf, 
           fill = "#d4edda", alpha = 0.3) +
  annotate("rect", xmin = -Inf, xmax = 0, ymin = -Inf, ymax = 0, 
           fill = "#f8d7da", alpha = 0.3) +
  geom_point(aes(color = (AAPL > 0 & MSFT > 0) | (AAPL < 0 & MSFT < 0)), 
             size = 3, alpha = 0.7) +
  scale_color_manual(values = c("#6c757d", "#0d6efd"), 
                     labels = c("Opposite", "Same Direction"),
                     name = "Movement") +
  geom_smooth(method = "lm", color = "#dc3545", linewidth = 1.5, se = FALSE) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray40", linewidth = 0.8) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray40", linewidth = 0.8) +
  labs(title = "üçé AAPL vs üü¶ MSFT: Joint Return Distribution",
       x = "Apple Daily Return (%)", y = "Microsoft Daily Return (%)") +
  theme_minimal(base_size = 16) +
  theme(legend.position = "bottom",
        plot.title = element_text(size = 22, face = "bold", hjust = 0.5))

# Add marginal histograms using ggExtra
ggMarginal(p, type = "histogram", fill = "steelblue", alpha = 0.7, 
           xparams = list(bins = 30), yparams = list(bins = 30))
```

## üí∞ Case Study: Joint Density Heatmap {.larger}

```{r}
#| echo: true
#| code-fold: true
#| code-summary: "üî• Show Heatmap Code"
#| message: false
#| warning: false
#| eval: true
#| fig-width: 11
#| fig-height: 6.5
#| fig-align: center

# Beautiful 2D density with contours
ggplot(returns_df, aes(x = AAPL * 100, y = MSFT * 100)) +
  stat_density_2d(aes(fill = after_stat(density)), 
                  geom = "raster", contour = FALSE) +
  stat_density_2d(color = "white", linewidth = 0.3, alpha = 0.5) +
  scale_fill_viridis_c(option = "turbo", name = "Density") +
  geom_point(alpha = 0.15, color = "white", size = 1) +
  # Add confidence ellipse
  stat_ellipse(level = 0.95, color = "#ffc107", linewidth = 2, linetype = "solid") +
  stat_ellipse(level = 0.50, color = "#ffc107", linewidth = 1.5, linetype = "dashed") +
  # Reference lines
  geom_hline(yintercept = 0, color = "white", linewidth = 0.5, alpha = 0.7) +
  geom_vline(xintercept = 0, color = "white", linewidth = 0.5, alpha = 0.7) +
  labs(title = "üî• Empirical Joint Density: Where Do Returns Concentrate?",
       subtitle = "Yellow ellipses: 50% and 95% confidence regions",
       x = "Apple Return (%)", y = "Microsoft Return (%)") +
  theme_minimal(base_size = 18) +
  theme(plot.title = element_text(size = 22, face = "bold"),
        plot.subtitle = element_text(size = 16, color = "gray40"),
        legend.position = "right",
        panel.grid = element_blank(),
        panel.background = element_rect(fill = "gray10")) +
  coord_fixed(ratio = 1)
```

## üí∞ Case Study: Marginal Distributions {.larger}

```{r}
#| echo: true
#| code-fold: true
#| code-summary: "üìä Show Marginal Distributions Code"
#| message: false
#| warning: false
#| eval: true
#| fig-width: 12
#| fig-height: 6
#| fig-align: center

library(patchwork)

# Prepare data in long format
returns_long <- returns_df %>%
  pivot_longer(cols = c(AAPL, MSFT), names_to = "Stock", values_to = "Return") %>%
  mutate(Return_pct = Return * 100)

# Creative marginal comparison plot
p1 <- ggplot(returns_long, aes(x = Return_pct, fill = Stock)) +
  geom_density(alpha = 0.6, linewidth = 1) +
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray30") +
  scale_fill_manual(values = c("AAPL" = "#ff6b6b", "MSFT" = "#4dabf7"),
                    labels = c("üçé Apple", "üü¶ Microsoft")) +
  labs(title = "Marginal Density Comparison",
       x = "Daily Return (%)", y = "Density") +
  theme_minimal(base_size = 16) +
  theme(legend.position = "top",
        plot.title = element_text(face = "bold", size = 18))

# Box + violin plot
p2 <- ggplot(returns_long, aes(x = Stock, y = Return_pct, fill = Stock)) +
  geom_violin(alpha = 0.4, width = 0.8) +
  geom_boxplot(width = 0.15, alpha = 0.8, outlier.shape = 21) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +
  scale_fill_manual(values = c("AAPL" = "#ff6b6b", "MSFT" = "#4dabf7")) +
  labs(title = "Return Distribution Shape",
       x = "", y = "Daily Return (%)") +
  theme_minimal(base_size = 16) +
  theme(legend.position = "none",
        plot.title = element_text(face = "bold", size = 18)) +
  coord_flip()

p1 + p2 + plot_layout(widths = c(2, 1))
```

::: {style="font-size: 32px; text-align: center; margin-top: 10px;"}
üí° **Key Insight:** Similar shapes confirm both are from same market sector ‚Äî marginals alone don't reveal the strong positive correlation!
:::

## üí∞ Case Study: Key Findings {.larger}

::::: {.callout-important style="font-size: 36px;"}
## üìä What Did We Learn?

:::: columns
::: {.column width="50%"}
**üîç Joint Distribution:**

- ‚úÖ Strong positive correlation (~0.7-0.8)
- ‚úÖ Both stocks move together
- ‚úÖ Elliptical pattern ‚Üí bivariate normal
- ‚úÖ Concentration near origin (small daily changes)

**üìä Marginals:**

- Similar volatility levels
- Approximately symmetric
- Slight positive mean
:::

::: {.column width="50%"}
**üíº Portfolio Implications:**

1. **Limited Diversification**
   - High correlation = risk doesn't drop much

2. **Sector Risk**
   - Both exposed to tech sector factors

3. **Better Diversification**
   - Need assets from different sectors
   - Look for low/negative correlation

üí° **Key Lesson:** Joint distribution reveals dependence that marginals hide!
:::
::::
:::::

## üìù Quiz #1: Joint Probability Functions {.larger .quiz-question}

::: {style="font-size: 36px;"}
For a valid joint probability function $p(y_1, y_2)$, which must be true?

-   [$p(y_1, y_2) \geq 0$ for all $(y_1, y_2)$ **and** $\sum_{y_1}\sum_{y_2} p(y_1, y_2) = 1$]{.correct data-explanation="‚úÖ Correct! Joint probability functions must be non-negative everywhere and sum to 1 over all possible pairs."}

-   $p(y_1, y_2) \geq 0$ for all $(y_1, y_2)$ and $\sum_{y_1}\sum_{y_2} p(y_1, y_2) \leq 1$

-   $0 \leq p(y_1, y_2) \leq 1$ for all $(y_1, y_2)$ and no constraint on sum

-   $p(y_1, y_2) > 0$ for all $(y_1, y_2)$ and $\sum_{y_1}\sum_{y_2} p(y_1, y_2) = 1$
:::

## üìù Quiz #2: Computing Marginal Distributions {.larger .quiz-question}

::: {style="font-size: 36px;"}
To find marginal distribution $f_1(y_1)$ from joint pdf $f(y_1, y_2)$, you should:

-   [Integrate $f(y_1, y_2)$ with respect to $y_2$ over all possible values of $y_2$]{.correct data-explanation="‚úÖ Correct! The marginal density f‚ÇÅ(y‚ÇÅ) = ‚à´f(y‚ÇÅ, y‚ÇÇ)dy‚ÇÇ is found by integrating out the other variable."}

-   Differentiate $f(y_1, y_2)$ with respect to $y_2$

-   Set $y_2 = 0$ in $f(y_1, y_2)$

-   Multiply $f(y_1, y_2)$ by $y_2$ and integrate
:::

## üìù Quiz #3: Bivariate Density Interpretation {.larger .quiz-question}

::: {style="font-size: 34px;"}
For continuous $(Y_1, Y_2)$ with joint pdf $f(y_1, y_2)$, probability $P(Y_1 \leq a, Y_2 \leq b)$ equals:

-   [The **volume** under the surface $f(y_1, y_2)$ over region $(-\infty, a] \times (-\infty, b]$]{.correct data-explanation="‚úÖ Correct! For continuous bivariate distributions, probabilities are calculated as volumes under the density surface over the specified region."}

-   The value $f(a, b)$

-   The area under the curve $f(y_1, y_2) = a + b$

-   The double derivative of $f(y_1, y_2)$ at $(a, b)$
:::

## üìù Summary {.larger}

::::: {.callout-note style="font-size: 40px;"}
## ‚úÖ Key Takeaways

:::: columns
::: {.column width="50%"}
**Definitions:**

- **Joint pmf/pdf**: $p(y_1, y_2)$ or $f(y_1, y_2)$
- Non-negative, sums/integrates to 1

**Joint CDF:**

- $F(y_1, y_2) = P(Y_1 \leq y_1, Y_2 \leq y_2)$
- "Southwest rectangle" interpretation
:::

::: {.column width="50%"}
**Marginals:**

- Sum/integrate out the other variable
- $f_1(y_1) = \int f(y_1, y_2) \, dy_2$

**Key Insight:**

- Joint distribution captures **dependence**
- Marginals alone miss correlation!
- Essential for portfolio risk analysis
:::
::::
:::::

## üìö Practice Problems {.larger}

::::: {.callout-tip style="font-size: 42px;"}
## üìù Homework

:::: columns
::: {.column width="50%"}
**Problem 1 (Discrete):**

Verify a $3 \times 3$ joint pmf table is valid and find both marginal distributions.

**Problem 2 (Continuous):**

For $f(y_1, y_2) = cy_1y_2$ on $[0,2] \times [0,1]$:

- Find constant $c$
- Compute $P(Y_1 > 1, Y_2 < 0.5)$
:::

::: {.column width="50%"}
**Problem 3 (Marginals):**

Given $f(y_1, y_2) = 2$ for $0 < y_2 < y_1 < 1$:

- Find $f_1(y_1)$ and $f_2(y_2)$

**Problem 4 (Finance):**

For two assets with joint distribution, find:

- $P(\text{both positive returns})$
:::
::::
:::::

## üëã Thank You! {.larger .center}

::::: {style="font-size: 42px;"}
:::: columns
::: {.column width="50%"}
**üì¨ Contact:**

Samir Orujov, PhD

Assistant Professor, School of Business

ADA University

üìß [sorujov@ada.edu.az](mailto:sorujov@ada.edu.az)

üè¢ Office: D312

‚è∞ Office Hours: By appointment
:::

::: {.column width="50%"}
**üìÖ Next Class:**

**Topic:** Conditional Distributions & Independence

**Reading:** Chapter 5, Sections 5.3-5.4

**‚è∞ To-Do:**

‚úÖ Complete Practice Problems 1-4

‚úÖ Review double integrals

‚úÖ Think about independence

‚úÖ Work hard! üí™
:::
::::
:::::

## ‚ùì Questions? {.larger .center}

::::: {.callout-note style="font-size: 44px;"}
## üí¨ Discussion Topics

:::: columns
::: {.column width="50%"}
ü§î **Think About:**

- How do joint distributions help understand portfolio risk?

- Why are marginals insufficient for dependence?
:::

::: {.column width="50%"}
üåê **Real-World Examples:**

- When is knowing joint distribution crucial?

- How do we estimate joint distributions from data?
:::
::::
:::::